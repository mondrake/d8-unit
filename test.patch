diff --git a/core/lib/Drupal/Component/PhpStorage/FileStorage.php b/core/lib/Drupal/Component/PhpStorage/FileStorage.php
index a694144b71..3905606765 100644
--- a/core/lib/Drupal/Component/PhpStorage/FileStorage.php
+++ b/core/lib/Drupal/Component/PhpStorage/FileStorage.php
@@ -51,7 +51,12 @@ public function load($name) {
   public function save($name, $code) {
     $path = $this->getFullPath($name);
     $directory = dirname($path);
-    $this->ensureDirectory($directory);
+    try {
+      $this->ensureDirectory($directory);
+    }
+    catch (\RuntimeException $e) {
+      return FALSE;
+    }
     return (bool) file_put_contents($path, $code);
   }
 
@@ -68,6 +73,9 @@ public function save($name, $code) {
    *   The directory path.
    * @param int $mode
    *   The mode, permissions, the directory should have.
+   *
+   * @throws \RuntimeException
+   *   If directory creation failed.
    */
   protected function ensureDirectory($directory, $mode = 0777) {
     if ($this->createDirectory($directory, $mode)) {
@@ -90,9 +98,13 @@ protected function ensureDirectory($directory, $mode = 0777) {
    *   The mode, permissions, the directory should have.
    *
    * @return bool
-   *   TRUE if the directory exists or has been created, FALSE otherwise.
+   *   TRUE if the directory exists or has been created.
+   *
+   * @throws \RuntimeException
+   *   If directory creation failed.
    */
   protected function createDirectory($directory, $mode = 0777) {
+dump([__METHOD__, 'a', $directory]);
     // If the directory exists already, there's nothing to do.
     if (is_dir($directory)) {
       return TRUE;
@@ -109,9 +121,12 @@ protected function createDirectory($directory, $mode = 0777) {
     if ($parent_exists) {
       // We hide warnings and ignore the return because there may have been a
       // race getting here and the directory could already exist.
+dump([__METHOD__, 'b', $directory]);
       @mkdir($directory);
+dump([__METHOD__, 'c', $directory]);
       // Only try to chmod() if the subdirectory could be created.
       if (is_dir($directory)) {
+dump([__METHOD__, 'd', $directory]);
         // Avoid writing permissions if possible.
         if (fileperms($directory) !== $mode) {
           return chmod($directory, $mode);
@@ -120,7 +135,8 @@ protected function createDirectory($directory, $mode = 0777) {
       }
       else {
         // Something failed and the directory doesn't exist.
-        trigger_error('mkdir(): Permission Denied', E_USER_WARNING);
+dump([__METHOD__, $directory]);
+        throw new \RuntimeException('mkdir(): Permission Denied');
       }
     }
     return FALSE;
diff --git a/core/lib/Drupal/Component/PhpStorage/MTimeProtectedFastFileStorage.php b/core/lib/Drupal/Component/PhpStorage/MTimeProtectedFastFileStorage.php
index 415079376f..3fd3572a8e 100644
--- a/core/lib/Drupal/Component/PhpStorage/MTimeProtectedFastFileStorage.php
+++ b/core/lib/Drupal/Component/PhpStorage/MTimeProtectedFastFileStorage.php
@@ -63,7 +63,12 @@ public function __construct(array $configuration) {
    * {@inheritdoc}
    */
   public function save($name, $data) {
-    $this->ensureDirectory($this->directory);
+    try {
+      $this->ensureDirectory($this->directory);
+    }
+    catch (\RuntimeException $e) {
+      return FALSE;
+    }
 
     // Write the file out to a temporary location. Prepend with a '.' to keep it
     // hidden from listings and web servers.
@@ -83,7 +88,12 @@ public function save($name, $data) {
     // atomically, i.e. there is no point at which another process attempting to
     // access the new path will find it missing.
     $directory = $this->getContainingDirectoryFullPath($name);
-    $this->ensureDirectory($directory);
+    try {
+      $this->ensureDirectory($directory);
+    }
+    catch (\RuntimeException $e) {
+      return FALSE;
+    }
     $full_path = $this->getFullPath($name, $directory, $mtime);
     $result = rename($temporary_path, $full_path);
 
diff --git a/core/phpstan-baseline.neon b/core/phpstan-baseline.neon
index 15db53472c..6526c6e7e2 100644
--- a/core/phpstan-baseline.neon
+++ b/core/phpstan-baseline.neon
@@ -2261,22 +2261,6 @@ parameters:
 			count: 1
 			path: tests/Drupal/Tests/Component/DependencyInjection/Dumper/OptimizedPhpArrayDumperTest.php
 
-		-
-			message: """
-				#^Call to deprecated method expectWarning\\(\\) of class PHPUnit\\\\Framework\\\\TestCase\\:
-				https\\://github\\.com/sebastianbergmann/phpunit/issues/5062$#
-			"""
-			count: 1
-			path: tests/Drupal/Tests/Component/PhpStorage/FileStorageTest.php
-
-		-
-			message: """
-				#^Call to deprecated method expectWarningMessage\\(\\) of class PHPUnit\\\\Framework\\\\TestCase\\:
-				https\\://github\\.com/sebastianbergmann/phpunit/issues/5062$#
-			"""
-			count: 1
-			path: tests/Drupal/Tests/Component/PhpStorage/FileStorageTest.php
-
 		-
 			message: "#^Constructor of class Drupal\\\\Tests\\\\Component\\\\Plugin\\\\Factory\\\\ArgumentsAllNull has an unused parameter \\$charismatic\\.$#"
 			count: 1
diff --git a/core/tests/Drupal/Tests/Component/PhpStorage/FileStorageTest.php b/core/tests/Drupal/Tests/Component/PhpStorage/FileStorageTest.php
index d7ca82e28b..aff7d356a8 100644
--- a/core/tests/Drupal/Tests/Component/PhpStorage/FileStorageTest.php
+++ b/core/tests/Drupal/Tests/Component/PhpStorage/FileStorageTest.php
@@ -101,14 +101,21 @@ public function testDeleteAll() {
    */
   public function testCreateDirectoryFailWarning() {
     $directory = new vfsStreamDirectory('permissionDenied', 0200);
+dump([__METHOD__, 'a', $directory, $directory->url()]);
     $storage = new FileStorage([
       'directory' => $directory->url(),
       'bin' => 'test',
     ]);
+dump([__METHOD__, 'b', $storage]);
     $code = "<?php\n echo 'here';";
-    $this->expectWarning();
-    $this->expectWarningMessage('mkdir(): Permission Denied');
-    $storage->save('subdirectory/foo.php', $code);
+    $this->expectException(\RuntimeException::class);
+    $this->expectExceptionMessage('mkdir(): Permission Denied');
+    $fullPath = $storage->getFullPath('subdirectory');
+dump([__METHOD__, 'c', $fullPath]);
+    $reflection = new \ReflectionClass($storage);
+    $reflectionMethod = $reflection->getMethod('createDirectory');
+dump([__METHOD__, $reflectionMethod]);
+    $reflectionMethod->invoke($storage, $fullPath);
   }
 
 }
