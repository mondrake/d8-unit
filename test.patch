diff --git a/core/core.services.yml b/core/core.services.yml
index 2891d06ceb..b90d738f2f 100644
--- a/core/core.services.yml
+++ b/core/core.services.yml
@@ -410,6 +410,11 @@ services:
     tags:
       - { name: event_subscriber }
   Drupal\Core\Database\ReplicaKillSwitch: '@database.replica_kill_switch'
+  database.statement_execution_subscriber:
+    class: Drupal\Core\Database\EventSubscriber\StatementExecutionSubscriber
+    tags:
+      - { name: event_subscriber }
+  Drupal\Core\Database\EventSubscriber\StatementExecutionSubscriber: '@database.statement_execution_subscriber'
   datetime.time:
     class: Drupal\Component\Datetime\Time
     arguments: ['@request_stack']
diff --git a/core/lib/Drupal/Core/Database/Connection.php b/core/lib/Drupal/Core/Database/Connection.php
index 142e452ceb..893ff981e5 100644
--- a/core/lib/Drupal/Core/Database/Connection.php
+++ b/core/lib/Drupal/Core/Database/Connection.php
@@ -3,6 +3,7 @@
 namespace Drupal\Core\Database;
 
 use Drupal\Component\Assertion\Inspector;
+use Drupal\Component\EventDispatcher\Event;
 use Drupal\Core\Database\Query\Condition;
 use Drupal\Core\Database\Query\Delete;
 use Drupal\Core\Database\Query\Insert;
@@ -216,6 +217,11 @@ abstract class Connection {
    */
   protected $identifierQuotes;
 
+  /**
+   * @todo
+   */
+  protected bool $statementEventsEnabled = FALSE;
+
   /**
    * Constructs a Connection object.
    *
@@ -1865,4 +1871,111 @@ public function hasJson(): bool {
     }
   }
 
+  /**
+   * @todo
+   */
+  public function areStatementEventsEnabled(): bool {
+    return $this->statementEventsEnabled;
+  }
+
+  /**
+   * @todo
+   */
+  public function enableStatementEvents(bool $toggle): static {
+    $this->statementEventsEnabled = $toggle;
+    return $this;
+  }
+
+  /**
+   * @todo
+   */
+  public function dispatchEvent(Event $event, ?string $eventName = NULL): Event {
+    if (\Drupal::hasService('event_dispatcher')) {
+      return \Drupal::service('event_dispatcher')->dispatch($event, $eventName);
+    }
+    return $event;
+  }
+
+  /**
+   * Determine the last non-database method that called the database API.
+   *
+   * Traversing the call stack from the very first call made during the
+   * request, we define "the routine that called this query" as the last entry
+   * in the call stack that is not any method called from the namespace of the
+   * database driver, is not inside the Drupal\Core\Database namespace and does
+   * have a file (which excludes call_user_func_array(), anonymous functions
+   * and similar). That makes the climbing logic very simple, and handles the
+   * variable stack depth caused by the query builders.
+   *
+   * See the @link http://php.net/debug_backtrace debug_backtrace() @endlink
+   * function.
+   *
+   * @return array
+   *   This method returns a stack trace entry similar to that generated by
+   *   debug_backtrace(). However, it flattens the trace entry and the trace
+   *   entry before it so that we get the function and args of the function that
+   *   called into the database system, not the function and args of the
+   *   database call itself.
+   */
+  public function findCallerFromDebugBacktrace(): array {
+    $stack = $this->removeDatabaseEntriesFromDebugBacktrace($this->getDebugBacktrace(), $this->getConnectionOptions()['namespace']);
+
+    // Return the first function call whose stack entry has a 'file' key, that
+    // is, it is not a callback or a closure.
+    for ($i = 0; $i < count($stack); $i++) {
+      if (!empty($stack[$i]['file'])) {
+        return [
+          'file' => $stack[$i]['file'],
+          'line' => $stack[$i]['line'],
+          'function' => $stack[$i + 1]['function'],
+          'class' => $stack[$i + 1]['class'] ?? NULL,
+          'type' => $stack[$i + 1]['type'] ?? NULL,
+          'args' => $stack[$i + 1]['args'] ?? [],
+        ];
+      }
+    }
+
+    return [];
+  }
+
+  /**
+   * Removes database related calls from a backtrace array.
+   *
+   * @param array $backtrace
+   *   A standard PHP backtrace. Passed by reference.
+   * @param string $driver_namespace
+   *   The PHP namespace of the database driver.
+   *
+   * @return array
+   *   The cleaned backtrace array.
+   */
+  public static function removeDatabaseEntriesFromDebugBacktrace(array $backtrace, string $driver_namespace): array {
+    // Starting from the very first entry processed during the request, find
+    // the first function call that can be identified as a call to a
+    // method/function in the database layer.
+    for ($n = count($backtrace) - 1; $n >= 0; $n--) {
+      // If the call was made from a function, 'class' will be empty. We give
+      // it a default empty string value in that case.
+      $class = $backtrace[$n]['class'] ?? '';
+      if (strpos($class, __NAMESPACE__, 0) === 0 || strpos($class, $driver_namespace, 0) === 0) {
+        break;
+      }
+    }
+
+    return array_values(array_slice($backtrace, $n));
+  }
+
+  /**
+   * Gets the debug backtrace.
+   *
+   * Wraps the debug_backtrace function to allow mocking results in PHPUnit
+   * tests.
+   *
+   * @return array[]
+   *   The debug backtrace.
+   */
+  protected function getDebugBacktrace(): array {
+    return debug_backtrace();
+  }
+
 }
diff --git a/core/lib/Drupal/Core/Database/Database.php b/core/lib/Drupal/Core/Database/Database.php
index 9b5364942b..039960f38c 100644
--- a/core/lib/Drupal/Core/Database/Database.php
+++ b/core/lib/Drupal/Core/Database/Database.php
@@ -122,6 +122,7 @@ abstract class Database {
       // logging object associated with it.
       if (!empty(self::$connections[$key])) {
         foreach (self::$connections[$key] as $connection) {
+          $connection->enableStatementEvents(TRUE);
           $connection->setLogger(self::$logs[$key]);
         }
       }
@@ -450,6 +451,7 @@ abstract class Database {
     // If we have any active logging objects for this connection key, we need
     // to associate them with the connection we just opened.
     if (!empty(self::$logs[$key])) {
+      $new_connection->enableStatementEvents(TRUE);
       $new_connection->setLogger(self::$logs[$key]);
     }
 
diff --git a/core/lib/Drupal/Core/Database/DatabaseEvents.php b/core/lib/Drupal/Core/Database/DatabaseEvents.php
new file mode 100644
index 0000000000..95fdf6893f
--- /dev/null
+++ b/core/lib/Drupal/Core/Database/DatabaseEvents.php
@@ -0,0 +1,28 @@
+<?php
+
+namespace Drupal\Core\Database;
+
+/**
+ * Defines events for the database system.
+ */
+final class DatabaseEvents {
+
+  /**
+   * Name of the event fired when starting a statement execution.
+   *
+   * @Event
+   *
+   * @var string
+   */
+  const STATEMENT_EXECUTION_START = 'database.statement.execution.start';
+
+  /**
+   * Name of the event fired when a statement execution is finished.
+   *
+   * @Event
+   *
+   * @var string
+   */
+  const STATEMENT_EXECUTION_END = 'database.statement.execution.end';
+
+}
diff --git a/core/lib/Drupal/Core/Database/Event/DatabaseEvent.php b/core/lib/Drupal/Core/Database/Event/DatabaseEvent.php
new file mode 100644
index 0000000000..6f6ceca67d
--- /dev/null
+++ b/core/lib/Drupal/Core/Database/Event/DatabaseEvent.php
@@ -0,0 +1,11 @@
+<?php
+
+namespace Drupal\Core\Database\Event;
+
+use Drupal\Component\EventDispatcher\Event;
+
+/**
+ * Represents a database event.
+ */
+abstract class DatabaseEvent extends Event {
+}
diff --git a/core/lib/Drupal/Core/Database/Event/StatementExecutionEvent.php b/core/lib/Drupal/Core/Database/Event/StatementExecutionEvent.php
new file mode 100644
index 0000000000..070c2cd249
--- /dev/null
+++ b/core/lib/Drupal/Core/Database/Event/StatementExecutionEvent.php
@@ -0,0 +1,59 @@
+<?php
+
+namespace Drupal\Core\Database\Event;
+
+/**
+ * Represents a statement execution as an event.
+ */
+class StatementExecutionEvent extends DatabaseEvent {
+
+  /**
+   * The time of the statement execution start.
+   */
+  protected float $startTime;
+
+  /**
+   * The time of the statement execution end.
+   */
+  protected float $endTime;
+
+  /**
+   * Constructs a StatementExecutionEvent object.
+   */
+  public function __construct(
+    public readonly string $key,
+    public readonly string $target,
+    public readonly string $queryString,
+    public readonly array $args,
+    public readonly array $caller,
+  ) {}
+
+  /**
+   * Sets the query start time.
+   */
+  public function setStartTime(float $time): void {
+    $this->startTime = $time;
+  }
+
+  /**
+   * Sets the query end time.
+   */
+  public function setEndTime(float $time): void {
+    $this->endTime = $time;
+  }
+
+  /**
+   * Gets the query start time.
+   */
+  public function getStartTime(): float {
+    return $this->startTime;
+  }
+
+  /**
+   * Gets the query end time.
+   */
+  public function getEndTime(): float {
+    return $this->endTime;
+  }
+
+}
diff --git a/core/lib/Drupal/Core/Database/EventSubscriber/StatementExecutionSubscriber.php b/core/lib/Drupal/Core/Database/EventSubscriber/StatementExecutionSubscriber.php
new file mode 100644
index 0000000000..fc94a471be
--- /dev/null
+++ b/core/lib/Drupal/Core/Database/EventSubscriber/StatementExecutionSubscriber.php
@@ -0,0 +1,39 @@
+<?php
+
+namespace Drupal\Core\Database\EventSubscriber;
+
+use Drupal\Core\Database\Database;
+use Drupal\Core\Database\DatabaseEvents;
+use Drupal\Core\Database\Event\StatementExecutionEvent;
+use Symfony\Component\EventDispatcher\EventSubscriberInterface;
+
+/**
+ * Response subscriber to statement executions.
+ */
+class StatementExecutionSubscriber implements EventSubscriberInterface {
+
+  /**
+   * {@inheritdoc}
+   */
+  public static function getSubscribedEvents(): array {
+    return [
+      DatabaseEvents::STATEMENT_EXECUTION_END => 'onStatementExecutionEnd',
+    ];
+  }
+
+  /**
+   * Subscribes to a statement execution finished event.
+   *
+   * Logs the statement query if logging is active.
+   *
+   * @param \Drupal\Core\Database\Event\StatementExecutionEvent $event
+   *   The database event.
+   */
+  public function onStatementExecutionEnd(StatementExecutionEvent $event): void {
+    $logger = Database::getConnection($event->target, $event->key)->getLogger();
+    if ($logger) {
+      $logger->logFromEvent($event);
+    }
+  }
+
+}
diff --git a/core/lib/Drupal/Core/Database/Log.php b/core/lib/Drupal/Core/Database/Log.php
index b310d17284..7d1d942153 100644
--- a/core/lib/Drupal/Core/Database/Log.php
+++ b/core/lib/Drupal/Core/Database/Log.php
@@ -2,6 +2,8 @@
 
 namespace Drupal\Core\Database;
 
+use Drupal\Core\Database\Event\StatementExecutionEvent;
+
 /**
  * Database query logger.
  *
@@ -100,6 +102,25 @@ public function end($logging_key) {
     unset($this->queryLog[$logging_key]);
   }
 
+  /**
+   * Log a query to all active logging keys, from a statement execution event.
+   *
+   * @param \Drupal\Core\Database\Event\StatementExecutionEvent $event
+   *   The statement execution event.
+   */
+  public function logFromEvent(StatementExecutionEvent $event): void {
+    foreach (array_keys($this->queryLog) as $key) {
+      $this->queryLog[$key][] = [
+        'query' => $event->queryString,
+        'args' => $event->args,
+        'target' => $event->target,
+        'caller' => $event->caller,
+        'time' => $event->getEndTime() - $event->getStartTime(),
+        'start' => $event->getStartTime(),
+      ];
+    }
+  }
+
   /**
    * Log a query to all active logging keys.
    *
@@ -113,8 +134,14 @@ public function end($logging_key) {
    * @param float $start
    *   The time the query started as a float (in seconds since the Unix epoch
    *   with microsecond precision).
+   *
+   * @deprecated in drupal:10.1.0 and is removed from drupal:11.0.0. Use
+   *   ::logFromEvent().
+   *
+   * @see https://www.drupal.org/node/3328053
    */
   public function log(StatementInterface $statement, $args, $time, float $start = NULL) {
+    @trigger_error(__METHOD__ . '() is deprecated in drupal:10.1.0 and is removed from drupal:11.0.0. Use ::logFromEvent(). See https://www.drupal.org/node/3328053', E_USER_DEPRECATED);
     foreach (array_keys($this->queryLog) as $key) {
       $this->queryLog[$key][] = [
         'query' => $statement->getQueryString(),
@@ -147,8 +174,14 @@ public function log(StatementInterface $statement, $args, $time, float $start =
    *   entry before it so that we get the function and args of the function that
    *   called into the database system, not the function and args of the
    *   database call itself.
+   *
+   * @deprecated in drupal:10.1.0 and is removed from drupal:11.0.0. Use
+   *   Connection::findCallerFromDebugBacktrace().
+   *
+   * @see https://www.drupal.org/node/3328053
    */
   public function findCaller() {
+    @trigger_error(__METHOD__ . '() is deprecated in drupal:10.1.0 and is removed from drupal:11.0.0. Use Connection::findCallerFromDebugBacktrace(). See https://www.drupal.org/node/3328053', E_USER_DEPRECATED);
     $driver_namespace = Database::getConnectionInfo($this->connectionKey)['default']['namespace'];
     $stack = static::removeDatabaseEntries($this->getDebugBacktrace(), $driver_namespace);
 
@@ -178,21 +211,15 @@ public function findCaller() {
    *
    * @return array
    *   The cleaned backtrace array.
+   *
+   * @deprecated in drupal:10.1.0 and is removed from drupal:11.0.0. Use
+   *   Connection::removeDatabaseEntriesFromDebugBacktrace().
+   *
+   * @see https://www.drupal.org/node/3328053
    */
   public static function removeDatabaseEntries(array $backtrace, string $driver_namespace): array {
-    // Starting from the very first entry processed during the request, find
-    // the first function call that can be identified as a call to a
-    // method/function in the database layer.
-    for ($n = count($backtrace) - 1; $n >= 0; $n--) {
-      // If the call was made from a function, 'class' will be empty. We give
-      // it a default empty string value in that case.
-      $class = $backtrace[$n]['class'] ?? '';
-      if (strpos($class, __NAMESPACE__, 0) === 0 || strpos($class, $driver_namespace, 0) === 0) {
-        break;
-      }
-    }
-
-    return array_values(array_slice($backtrace, $n));
+    @trigger_error(__METHOD__ . '() is deprecated in drupal:10.1.0 and is removed from drupal:11.0.0. Use Connection::removeDatabaseEntriesFromDebugBacktrace(). See https://www.drupal.org/node/3328053', E_USER_DEPRECATED);
+    return Connection::removeDatabaseEntriesFromDebugBacktrace($backtrace, $driver_namespace);
   }
 
   /**
@@ -203,8 +230,14 @@ public static function removeDatabaseEntries(array $backtrace, string $driver_na
    *
    * @return array[]
    *   The debug backtrace.
+   *
+   * @deprecated in drupal:10.1.0 and is removed from drupal:11.0.0. There is
+   *   no replacement.
+   *
+   * @see https://www.drupal.org/node/3328053
    */
   protected function getDebugBacktrace() {
+    @trigger_error(__METHOD__ . '() is deprecated in drupal:10.1.0 and is removed from drupal:11.0.0. There is no replacement. See https://www.drupal.org/node/3328053', E_USER_DEPRECATED);
     return debug_backtrace();
   }
 
diff --git a/core/lib/Drupal/Core/Database/StatementPrefetch.php b/core/lib/Drupal/Core/Database/StatementPrefetch.php
index 0702bd1de4..2c51df4944 100644
--- a/core/lib/Drupal/Core/Database/StatementPrefetch.php
+++ b/core/lib/Drupal/Core/Database/StatementPrefetch.php
@@ -2,6 +2,8 @@
 
 namespace Drupal\Core\Database;
 
+use Drupal\Core\Database\Event\StatementExecutionEvent;
+
 /**
  * An implementation of StatementInterface that prefetches all data.
  *
@@ -172,9 +174,16 @@ public function execute($args = [], $options = []) {
       }
     }
 
-    $logger = $this->connection->getLogger();
-    if (!empty($logger)) {
-      $query_start = microtime(TRUE);
+    if ($this->connection->areStatementEventsEnabled()) {
+      $event = new StatementExecutionEvent(
+        $this->connection->getKey(),
+        $this->connection->getTarget(),
+        $this->getQueryString(),
+        $args ?? [],
+        $this->connection->findCallerFromDebugBacktrace()
+      );
+      $event->setStartTime(microtime(TRUE));
+      $this->connection->dispatchEvent($event, DatabaseEvents::STATEMENT_EXECUTION_START);
     }
 
     // Prepare the query.
@@ -207,9 +216,9 @@ public function execute($args = [], $options = []) {
       $this->columnNames = [];
     }
 
-    if (!empty($logger)) {
-      $query_end = microtime(TRUE);
-      $logger->log($this, $args, $query_end - $query_start, $query_start);
+    if (isset($event)) {
+      $event->setEndTime(microtime(TRUE));
+      $this->connection->dispatchEvent($event, DatabaseEvents::STATEMENT_EXECUTION_END);
     }
 
     // Initialize the first row in $this->currentRow.
diff --git a/core/lib/Drupal/Core/Database/StatementWrapper.php b/core/lib/Drupal/Core/Database/StatementWrapper.php
index 8a3bc208c5..36d8a35532 100644
--- a/core/lib/Drupal/Core/Database/StatementWrapper.php
+++ b/core/lib/Drupal/Core/Database/StatementWrapper.php
@@ -2,6 +2,8 @@
 
 namespace Drupal\Core\Database;
 
+use Drupal\Core\Database\Event\StatementExecutionEvent;
+
 // cSpell:ignore maxlen driverdata INOUT
 
 /**
@@ -87,16 +89,23 @@ public function execute($args = [], $options = []) {
       }
     }
 
-    $logger = $this->connection->getLogger();
-    if (!empty($logger)) {
-      $query_start = microtime(TRUE);
+    if ($this->connection->areStatementEventsEnabled()) {
+      $event = new StatementExecutionEvent(
+        $this->connection->getKey(),
+        $this->connection->getTarget(),
+        $this->getQueryString(),
+        $args ?? [],
+        $this->connection->findCallerFromDebugBacktrace()
+      );
+      $event->setStartTime(microtime(TRUE));
+      $this->connection->dispatchEvent($event, DatabaseEvents::STATEMENT_EXECUTION_START);
     }
 
     $return = $this->clientStatement->execute($args);
 
-    if (!empty($logger)) {
-      $query_end = microtime(TRUE);
-      $logger->log($this, $args, $query_end - $query_start, $query_start);
+    if (isset($event)) {
+      $event->setEndTime(microtime(TRUE));
+      $this->connection->dispatchEvent($event, DatabaseEvents::STATEMENT_EXECUTION_END);
     }
 
     return $return;
diff --git a/core/lib/Drupal/Core/Utility/Error.php b/core/lib/Drupal/Core/Utility/Error.php
index 1f55be5a29..d5bb777f06 100644
--- a/core/lib/Drupal/Core/Utility/Error.php
+++ b/core/lib/Drupal/Core/Utility/Error.php
@@ -4,9 +4,9 @@
 
 use Drupal\Component\Render\FormattableMarkup;
 use Drupal\Component\Utility\Xss;
+use Drupal\Core\Database\Connection;
 use Drupal\Core\Database\Database;
 use Drupal\Core\Database\DatabaseExceptionWrapper;
-use Drupal\Core\Database\Log;
 
 /**
  * Drupal error utility class.
@@ -52,7 +52,7 @@ public static function decodeException($exception) {
     // skipping internal functions of the database layer.
     if ($exception instanceof \PDOException || $exception instanceof DatabaseExceptionWrapper) {
       $driver_namespace = Database::getConnectionInfo()['default']['namespace'];
-      $backtrace = Log::removeDatabaseEntries($backtrace, $driver_namespace);
+      $backtrace = Connection::removeDatabaseEntriesFromDebugBacktrace($backtrace, $driver_namespace);
       if (isset($exception->query_string, $exception->args)) {
         $message .= ": " . $exception->query_string . "; " . print_r($exception->args, TRUE);
       }
diff --git a/core/phpstan-baseline.neon b/core/phpstan-baseline.neon
index cf84abce27..e9f0f726b9 100644
--- a/core/phpstan-baseline.neon
+++ b/core/phpstan-baseline.neon
@@ -330,16 +330,6 @@ parameters:
 			count: 1
 			path: lib/Drupal/Core/Database/Query/Upsert.php
 
-		-
-			message: "#^Variable \\$query_start might not be defined\\.$#"
-			count: 2
-			path: lib/Drupal/Core/Database/StatementPrefetch.php
-
-		-
-			message: "#^Variable \\$query_start might not be defined\\.$#"
-			count: 2
-			path: lib/Drupal/Core/Database/StatementWrapper.php
-
 		-
 			message: "#^Call to deprecated constant REQUEST_TIME\\: Deprecated in drupal\\:8\\.3\\.0 and is removed from drupal\\:10\\.0\\.0\\. Use \\\\Drupal\\:\\:time\\(\\)\\-\\>getRequestTime\\(\\); $#"
 			count: 2
diff --git a/core/tests/Drupal/KernelTests/Core/Database/LoggingTest.php b/core/tests/Drupal/KernelTests/Core/Database/LoggingTest.php
index 7858169af1..976d2f7d91 100644
--- a/core/tests/Drupal/KernelTests/Core/Database/LoggingTest.php
+++ b/core/tests/Drupal/KernelTests/Core/Database/LoggingTest.php
@@ -146,7 +146,7 @@ public function testGetLoggingWrongKey() {
    *
    * @param string $driver_namespace
    *   The driver namespace to be tested.
-   * @param string $stack
+   * @param array $stack
    *   A test debug_backtrace stack.
    * @param array $expected_entry
    *   The expected stack entry.
@@ -154,8 +154,42 @@ public function testGetLoggingWrongKey() {
    * @covers ::findCaller
    *
    * @dataProvider providerContribDriverLog
+   *
+   * @group legacy
+   */
+  public function testLegacyContribDriverLog($driver_namespace, $stack, array $expected_entry) {
+    $this->expectDeprecation('Drupal\Core\Database\Log::findCaller() is deprecated in drupal:10.1.0 and is removed from drupal:11.0.0. Use Connection::findCallerFromDebugBacktrace(). See https://www.drupal.org/node/3328053');
+    $this->expectDeprecation('Drupal\Core\Database\Log::removeDatabaseEntries() is deprecated in drupal:10.1.0 and is removed from drupal:11.0.0. Use Connection::removeDatabaseEntriesFromDebugBacktrace(). See https://www.drupal.org/node/3328053');
+
+    $mock_builder = $this->getMockBuilder(Log::class);
+    $log = $mock_builder
+      ->onlyMethods(['getDebugBacktrace'])
+      ->setConstructorArgs(['test'])
+      ->getMock();
+    $log->expects($this->once())
+      ->method('getDebugBacktrace')
+      ->willReturn($stack);
+    Database::addConnectionInfo('test', 'default', ['driver' => 'mysql', 'namespace' => $driver_namespace]);
+
+    $result = $log->findCaller($stack);
+    $this->assertEquals($expected_entry, $result);
+  }
+
+  /**
+   * Tests that a log called by a custom database driver returns proper caller.
+   *
+   * @param string $driver_namespace
+   *   The driver namespace to be tested.
+   * @param array $stack
+   *   A test debug_backtrace stack.
+   * @param array $expected_entry
+   *   The expected stack entry.
+   *
+   * @covers ::logFromEvent
+   *
+   * @dataProvider providerContribDriverLog
    */
-  public function testContribDriverLog($driver_namespace, $stack, array $expected_entry) {
+  public function testContribDriverLog(string $driver_namespace, array $stack, array $expected_entry): void {
     $mock_builder = $this->getMockBuilder(Log::class);
     $log = $mock_builder
       ->onlyMethods(['getDebugBacktrace'])
diff --git a/core/tests/Drupal/Tests/Core/Database/ConnectionTest.php b/core/tests/Drupal/Tests/Core/Database/ConnectionTest.php
index e46a01d8e7..a0979a63ff 100644
--- a/core/tests/Drupal/Tests/Core/Database/ConnectionTest.php
+++ b/core/tests/Drupal/Tests/Core/Database/ConnectionTest.php
@@ -3,6 +3,7 @@
 namespace Drupal\Tests\Core\Database;
 
 use Composer\Autoload\ClassLoader;
+use Drupal\Core\Database\Database;
 use Drupal\Tests\Core\Database\Stub\StubConnection;
 use Drupal\Tests\Core\Database\Stub\StubPDO;
 use Drupal\Tests\UnitTestCase;
@@ -645,4 +646,28 @@ public function provideQueriesToTrim() {
     ];
   }
 
+  /**
+   * Tests that the proper caller is retrieved from the backtrace.
+   *
+   * @covers ::findCallerFromDebugBacktrace
+   * @covers ::removeDatabaseEntriesFromDebugBacktrace
+   * @covers ::getDebugBacktrace
+   */
+  public function testFindCallerFromDebugBacktrace() {
+    Database::addConnectionInfo('default', 'default', [
+      'driver' => 'test',
+      'namespace' => 'Drupal\Tests\Core\Database\Stub',
+    ]);
+    $connection = new StubConnection($this->createMock(StubPDO::class), []);
+    $result = $connection->findCallerFromDebugBacktrace();
+    $this->assertSame([
+      'file' => __FILE__,
+      'line' => 661,
+      'function' => 'testFindCallerFromDebugBacktrace',
+      'class' => 'Drupal\Tests\Core\Database\ConnectionTest',
+      'type' => '->',
+      'args' => [],
+    ], $result);
+  }
+
 }
diff --git a/core/tests/Drupal/Tests/Core/Database/LogTest.php b/core/tests/Drupal/Tests/Core/Database/LogTest.php
index 7184be4dc2..7d5e5fec71 100644
--- a/core/tests/Drupal/Tests/Core/Database/LogTest.php
+++ b/core/tests/Drupal/Tests/Core/Database/LogTest.php
@@ -12,6 +12,7 @@
  * Tests the Log class.
  *
  * @group Database
+ * @group legacy
  * @runTestsInSeparateProcesses
  * @preserveGlobalState disabled
  * @coversDefaultClass \Drupal\Core\Database\Log
@@ -29,11 +30,14 @@ public function testContribDriverLog() {
       'namespace' => 'Drupal\Tests\Core\Database\Stub',
     ]);
 
+    $this->expectDeprecation('Drupal\Core\Database\Log::findCaller() is deprecated in drupal:10.1.0 and is removed from drupal:11.0.0. Use Connection::findCallerFromDebugBacktrace(). See https://www.drupal.org/node/3328053');
+    $this->expectDeprecation('Drupal\Core\Database\Log::getDebugBacktrace() is deprecated in drupal:10.1.0 and is removed from drupal:11.0.0. There is no replacement. See https://www.drupal.org/node/3328053');
+    $this->expectDeprecation('Drupal\Core\Database\Log::removeDatabaseEntries() is deprecated in drupal:10.1.0 and is removed from drupal:11.0.0. Use Connection::removeDatabaseEntriesFromDebugBacktrace(). See https://www.drupal.org/node/3328053');
     $pdo = $this->prophesize(StubPDO::class)->reveal();
     $result = (new StubConnection($pdo, []))->testLogCaller();
     $this->assertSame([
       'file' => __FILE__,
-      'line' => 33,
+      'line' => 37,
       'function' => 'testContribDriverLog',
       'class' => 'Drupal\Tests\Core\Database\LogTest',
       'type' => '->',
@@ -41,10 +45,13 @@ public function testContribDriverLog() {
     ], $result);
 
     // Test calling the database log from outside of database code.
+    $this->expectDeprecation('Drupal\Core\Database\Log::findCaller() is deprecated in drupal:10.1.0 and is removed from drupal:11.0.0. Use Connection::findCallerFromDebugBacktrace(). See https://www.drupal.org/node/3328053');
+    $this->expectDeprecation('Drupal\Core\Database\Log::getDebugBacktrace() is deprecated in drupal:10.1.0 and is removed from drupal:11.0.0. There is no replacement. See https://www.drupal.org/node/3328053');
+    $this->expectDeprecation('Drupal\Core\Database\Log::removeDatabaseEntries() is deprecated in drupal:10.1.0 and is removed from drupal:11.0.0. Use Connection::removeDatabaseEntriesFromDebugBacktrace(). See https://www.drupal.org/node/3328053');
     $result = (new Log())->findCaller();
     $this->assertSame([
       'file' => __FILE__,
-      'line' => 44,
+      'line' => 51,
       'function' => 'testContribDriverLog',
       'class' => 'Drupal\Tests\Core\Database\LogTest',
       'type' => '->',
