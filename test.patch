diff --git a/core/drupalci.yml b/core/drupalci.yml
index cd92d8102d..cf1e26d809 100644
--- a/core/drupalci.yml
+++ b/core/drupalci.yml
@@ -9,43 +9,43 @@ _phpunit_testgroups_to_execute: &testgroups
 build:
   assessment:
     testing:
-      # Run code quality checks.
-      container_command.commit-checks:
-        commands:
-          - "core/scripts/dev/commit-code-check.sh --drupalci"
-        halt-on-fail: true
+#      # Run code quality checks.
+#      container_command.commit-checks:
+#        commands:
+#          - "core/scripts/dev/commit-code-check.sh --drupalci"
+#        halt-on-fail: true
       # run_tests task is executed several times in order of performance speeds.
       # halt-on-fail can be set on the run_tests tasks in order to fail fast.
       # suppress-deprecations is false in order to be alerted to usages of
       # deprecated code.
-      run_tests.phpunit:
-        types: 'PHPUnit-Unit'
-        suppress-deprecations: false
-        halt-on-fail: false
-        <<: *testgroups
-      run_tests.kernel:
-        types: 'PHPUnit-Kernel'
-        suppress-deprecations: false
-        halt-on-fail: false
-        <<: *testgroups
-      run_tests.build:
-        # Limit concurrency due to disk space concerns.
-        concurrency: 15
-        types: 'PHPUnit-Build'
-        suppress-deprecations: false
-        halt-on-fail: false
-        <<: *testgroups
+#      run_tests.phpunit:
+#        types: 'PHPUnit-Unit'
+#        suppress-deprecations: false
+#        halt-on-fail: false
+#        <<: *testgroups
+#      run_tests.kernel:
+#        types: 'PHPUnit-Kernel'
+#        suppress-deprecations: false
+#        halt-on-fail: false
+#        <<: *testgroups
+#      run_tests.build:
+#        # Limit concurrency due to disk space concerns.
+#        concurrency: 15
+#        types: 'PHPUnit-Build'
+#        suppress-deprecations: false
+#        halt-on-fail: false
+#        <<: *testgroups
       run_tests.functional:
         types: 'PHPUnit-Functional'
         suppress-deprecations: false
         halt-on-fail: false
         <<: *testgroups
-      run_tests.javascript:
-        concurrency: 15
-        types: 'PHPUnit-FunctionalJavascript'
-        suppress-deprecations: false
-        halt-on-fail: false
-        <<: *testgroups
-      # Run nightwatch testing.
-      # @see https://www.drupal.org/project/drupal/issues/2869825
-      nightwatchjs: {}
+#      run_tests.javascript:
+#        concurrency: 15
+#        types: 'PHPUnit-FunctionalJavascript'
+#        suppress-deprecations: false
+#        halt-on-fail: false
+#        <<: *testgroups
+#      # Run nightwatch testing.
+#      # @see https://www.drupal.org/project/drupal/issues/2869825
+#      nightwatchjs: {}
diff --git a/core/includes/form.inc b/core/includes/form.inc
index 4f353d0088..4b6e225a3b 100644
--- a/core/includes/form.inc
+++ b/core/includes/form.inc
@@ -897,9 +897,13 @@ function batch_process($redirect = NULL, Url $url = NULL, $redirect_callback = N
     // environments.
     \Drupal::moduleHandler()->alter('batch', $batch);
 
-    // Assign an arbitrary id: don't rely on a serial column in the 'batch'
-    // table, since non-progressive batches skip database storage completely.
-    $batch['id'] = \Drupal::database()->nextId();
+    // Assign an id: non-progressive batches skip database storage completely.
+    if ($batch['progressive']) {
+      $batch['id'] = \Drupal::service('batch.storage')->getId();
+    }
+    else {
+      $batch['id'] = rand();
+    }
 
     // Move operations to a job queue. Non-progressive batches will use a
     // memory-based queue.
diff --git a/core/lib/Drupal/Core/Batch/BatchStorage.php b/core/lib/Drupal/Core/Batch/BatchStorage.php
index 3c44628ef9..b1c52b95e3 100644
--- a/core/lib/Drupal/Core/Batch/BatchStorage.php
+++ b/core/lib/Drupal/Core/Batch/BatchStorage.php
@@ -149,13 +149,28 @@ public function create(array $batch) {
    *   The array representing the batch to create.
    */
   protected function doCreate(array $batch) {
-    $this->connection->insert('batch')
+    $this->connection->update('batch')
       ->fields([
-        'bid' => $batch['id'],
-        'timestamp' => REQUEST_TIME,
         'token' => $this->csrfToken->get($batch['id']),
         'batch' => serialize($batch),
       ])
+      ->condition('bid', $batch['id'])
+      ->execute();
+  }
+
+  /**
+   * Returns a new batch id.
+   *
+   * @return int
+   *   A batch id.
+   */
+  public function getId(): int {
+    return $this->connection->insert('batch')
+      ->fields([
+        'timestamp' => REQUEST_TIME,
+        'token' => '',
+        'batch' => NULL,
+      ])
       ->execute();
   }
 
@@ -208,9 +223,7 @@ public function schemaDefinition() {
       'fields' => [
         'bid' => [
           'description' => 'Primary Key: Unique batch ID.',
-          // This is not a serial column, to allow both progressive and
-          // non-progressive batches. See batch_process().
-          'type' => 'int',
+          'type' => 'serial',
           'unsigned' => TRUE,
           'not null' => TRUE,
         ],
diff --git a/core/lib/Drupal/Core/ProxyClass/Batch/BatchStorage.php b/core/lib/Drupal/Core/ProxyClass/Batch/BatchStorage.php
index 5e6fc6df6d..66adceadaf 100644
--- a/core/lib/Drupal/Core/ProxyClass/Batch/BatchStorage.php
+++ b/core/lib/Drupal/Core/ProxyClass/Batch/BatchStorage.php
@@ -107,6 +107,14 @@ public function create(array $batch)
             return $this->lazyLoadItself()->create($batch);
         }
 
+        /**
+         * {@inheritdoc}
+         */
+        public function getId(): int {
+        {
+            return $this->lazyLoadItself()->getId();
+        }
+
         /**
          * {@inheritdoc}
          */
