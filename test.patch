diff --git a/core/lib/Drupal/Core/Database/Connection.php b/core/lib/Drupal/Core/Database/Connection.php
index 67dc4a1a1a4b6d81c58f0adec1d98f9f4ed142cc..e07490b63cdec892efc24966b213f6f952b5f679 100644
--- a/core/lib/Drupal/Core/Database/Connection.php
+++ b/core/lib/Drupal/Core/Database/Connection.php
@@ -1923,6 +1923,13 @@ public static function createConnectionOptionsFromUrl($url, $root) {
       throw new \InvalidArgumentException('Minimum requirement: driver://host/database');
     }
 
+    if (!isset($url_components['query'])) {
+      @trigger_error('Not passing a ?module=db_driver_module part in the $url argument of ' . __METHOD__ . '() is deprecated in drupal:10.2.0 and is removed from drupal:11.0.0. All database connection URLs must have the module specified. See https://www.drupal.org/node/3129492', E_USER_DEPRECATED);
+    }
+    else {
+      parse_str($url_components['query'], $query);
+    }
+
     $url_components += [
       'user' => '',
       'pass' => '',
@@ -1938,6 +1945,7 @@ public static function createConnectionOptionsFromUrl($url, $root) {
     $reflector = new \ReflectionClass(static::class);
 
     $database = [
+      'module' => $query['module'] ?? explode('\\', $reflector->getNamespaceName())[1],
       'driver' => $url_components['scheme'],
       'username' => $url_components['user'],
       'password' => $url_components['pass'],
@@ -2006,6 +2014,9 @@ public static function createUrlFromConnectionOptions(array $connection_options)
     if (isset($connection_options['module'])) {
       $db_url .= '?module=' . $connection_options['module'];
     }
+    else {
+      @trigger_error('Not passing a \'module\' option to ' . __METHOD__ . '() is deprecated in drupal:10.2.0 and is removed from drupal:11.0.0. All database connections must have the module specified. See https://www.drupal.org/node/3129492', E_USER_DEPRECATED);
+    }
 
     if (isset($connection_options['prefix']) && $connection_options['prefix'] !== '') {
       $db_url .= '#' . $connection_options['prefix'];
diff --git a/core/lib/Drupal/Core/Database/Database.php b/core/lib/Drupal/Core/Database/Database.php
index c641ac203ded3843e1f23ef625ca5cfb86f4b829..853f1eb3e58380554eb3a2e6ffbfa856304258b0 100644
--- a/core/lib/Drupal/Core/Database/Database.php
+++ b/core/lib/Drupal/Core/Database/Database.php
@@ -556,11 +556,15 @@ public static function convertDbUrlToConnectionInfo($url, $root, ?bool $include_
     $url_component_query = $url_components['query'] ?? '';
     parse_str($url_component_query, $query);
 
+    // Start of BC layer.
     // Add the module key for core database drivers when the module key is not
     // set.
     if (!isset($query['module']) && in_array($driverName, ['mysql', 'pgsql', 'sqlite'], TRUE)) {
+      @trigger_error('Not passing a ?module=db_driver_module part in the $url argument of ' . __METHOD__ . '() is deprecated in drupal:10.2.0 and is removed from drupal:11.0.0. All database connection URLs must have the module specified. See https://www.drupal.org/node/3129492', E_USER_DEPRECATED);
       $query['module'] = $driverName;
     }
+    // End of BC layer.
+
     if (!isset($query['module'])) {
       throw new \InvalidArgumentException("Can not convert '$url' to a database connection, the module providing the driver '{$driverName}' is not specified");
     }
diff --git a/core/modules/sqlite/tests/src/Unit/ConnectionTest.php b/core/modules/sqlite/tests/src/Unit/ConnectionTest.php
index 1555d83f112eac0f09584ccf0c60c5be7c7aff49..08550e9eb599842eda50588d387da0b7c5425434 100644
--- a/core/modules/sqlite/tests/src/Unit/ConnectionTest.php
+++ b/core/modules/sqlite/tests/src/Unit/ConnectionTest.php
@@ -40,9 +40,9 @@ public function testCreateConnectionOptionsFromUrl(string $url, string $expected
   public function providerCreateConnectionOptionsFromUrl(): array {
     $root = dirname(__DIR__, 8);
     return [
-      'sqlite relative path' => ['sqlite://localhost/tmp/test', $root . '/tmp/test'],
-      'sqlite absolute path' => ['sqlite://localhost//tmp/test', '/tmp/test'],
-      'in memory sqlite path' => ['sqlite://localhost/:memory:', ':memory:'],
+      'sqlite relative path' => ['sqlite://localhost/tmp/test?module=sqlite', $root . '/tmp/test'],
+      'sqlite absolute path' => ['sqlite://localhost//tmp/test?module=sqlite', '/tmp/test'],
+      'in memory sqlite path' => ['sqlite://localhost/:memory:?module=sqlite', ':memory:'],
     ];
   }
 
diff --git a/core/tests/Drupal/TestSite/Commands/TestSiteInstallCommand.php b/core/tests/Drupal/TestSite/Commands/TestSiteInstallCommand.php
index f164d5bf694cc3551811a036eb4d1f3509d9a1e7..bc4254314c798b088b6bd189f8c6384fa05ec18b 100644
--- a/core/tests/Drupal/TestSite/Commands/TestSiteInstallCommand.php
+++ b/core/tests/Drupal/TestSite/Commands/TestSiteInstallCommand.php
@@ -99,7 +99,7 @@ protected function configure() {
       ->addOption('json', NULL, InputOption::VALUE_NONE, 'Output test site connection details in JSON.')
       ->addUsage('--setup-file core/tests/Drupal/TestSite/TestSiteMultilingualInstallTestScript.php --json')
       ->addUsage('--install-profile demo_umami --langcode fr')
-      ->addUsage('--base-url "http://example.com" --db-url "mysql://username:password@localhost/databasename#table_prefix"');
+      ->addUsage('--base-url "http://example.com" --db-url "mysql://username:password@localhost/databasename?module=mysql#table_prefix"');
   }
 
   /**
diff --git a/core/tests/Drupal/TestSite/Commands/TestSiteTearDownCommand.php b/core/tests/Drupal/TestSite/Commands/TestSiteTearDownCommand.php
index a2b5f54e32034ddacf1e5b301cfab58055e3c34a..7786c439319c3a0b28ab7ff5a0309929983a036e 100644
--- a/core/tests/Drupal/TestSite/Commands/TestSiteTearDownCommand.php
+++ b/core/tests/Drupal/TestSite/Commands/TestSiteTearDownCommand.php
@@ -30,7 +30,7 @@ protected function configure() {
       ->addOption('db-url', NULL, InputOption::VALUE_OPTIONAL, 'URL for database. Defaults to the environment variable SIMPLETEST_DB.', getenv('SIMPLETEST_DB'))
       ->addOption('keep-lock', NULL, InputOption::VALUE_NONE, 'Keeps the database prefix lock. Useful for ensuring test isolation when running concurrent tests.')
       ->addUsage('test12345678')
-      ->addUsage('test12345678 --db-url "mysql://username:password@localhost/databasename#table_prefix"')
+      ->addUsage('test12345678 --db-url "mysql://username:password@localhost/databasename?module=mysql#table_prefix"')
       ->addUsage('test12345678 --keep-lock');
   }
 
diff --git a/core/tests/Drupal/Tests/Core/Database/UrlConversionTest.php b/core/tests/Drupal/Tests/Core/Database/UrlConversionTest.php
index a4795b2da0b3e8897f2111a4707756169fd60cdb..0f58dd3bf38fc397963b875ecdfd39b49f159d0a 100644
--- a/core/tests/Drupal/Tests/Core/Database/UrlConversionTest.php
+++ b/core/tests/Drupal/Tests/Core/Database/UrlConversionTest.php
@@ -5,6 +5,7 @@
 use Drupal\Core\Database\Database;
 use Drupal\Core\Extension\Exception\UnknownExtensionException;
 use Drupal\Tests\UnitTestCase;
+use Symfony\Bridge\PhpUnit\ExpectDeprecationTrait;
 
 /**
  * Tests for database URL to/from database connection array conversions.
@@ -21,6 +22,8 @@
  */
 class UrlConversionTest extends UnitTestCase {
 
+  use ExpectDeprecationTrait;
+
   /**
    * {@inheritdoc}
    */
@@ -51,8 +54,9 @@ public function providerConvertDbUrlToConnectionInfo() {
     $root = dirname(__FILE__, 7);
     return [
       'MySql without prefix' => [
-        'mysql://test_user:test_pass@test_host:3306/test_database',
+        'mysql://test_user:test_pass@test_host:3306/test_database?module=mysql',
         [
+          'module' => 'mysql',
           'driver' => 'mysql',
           'username' => 'test_user',
           'password' => 'test_pass',
@@ -65,8 +69,9 @@ public function providerConvertDbUrlToConnectionInfo() {
         FALSE,
       ],
       'SQLite, relative to root, without prefix' => [
-        'sqlite://localhost/test_database',
+        'sqlite://localhost/test_database?module=sqlite',
         [
+          'module' => 'sqlite',
           'driver' => 'sqlite',
           'host' => 'localhost',
           'database' => $root . '/test_database',
@@ -76,8 +81,9 @@ public function providerConvertDbUrlToConnectionInfo() {
         FALSE,
       ],
       'MySql with prefix' => [
-        'mysql://test_user:test_pass@test_host:3306/test_database#bar',
+        'mysql://test_user:test_pass@test_host:3306/test_database?module=mysql#bar',
         [
+          'module' => 'mysql',
           'driver' => 'mysql',
           'username' => 'test_user',
           'password' => 'test_pass',
@@ -91,8 +97,9 @@ public function providerConvertDbUrlToConnectionInfo() {
         FALSE,
       ],
       'SQLite, relative to root, with prefix' => [
-        'sqlite://localhost/test_database#foo',
+        'sqlite://localhost/test_database?module=sqlite#foo',
         [
+          'module' => 'sqlite',
           'driver' => 'sqlite',
           'host' => 'localhost',
           'database' => $root . '/test_database',
@@ -103,8 +110,9 @@ public function providerConvertDbUrlToConnectionInfo() {
         FALSE,
       ],
       'SQLite, absolute path, without prefix' => [
-        'sqlite://localhost//baz/test_database',
+        'sqlite://localhost//baz/test_database?module=sqlite',
         [
+          'module' => 'sqlite',
           'driver' => 'sqlite',
           'host' => 'localhost',
           'database' => '/baz/test_database',
@@ -116,6 +124,7 @@ public function providerConvertDbUrlToConnectionInfo() {
       'MySQL contrib test driver without prefix' => [
         'DrivertestMysql://test_user:test_pass@test_host:3306/test_database?module=driver_test',
         [
+          'module' => 'driver_test',
           'driver' => 'DrivertestMysql',
           'username' => 'test_user',
           'password' => 'test_pass',
@@ -140,6 +149,7 @@ public function providerConvertDbUrlToConnectionInfo() {
       'MySQL contrib test driver with prefix' => [
         'DrivertestMysql://test_user:test_pass@test_host:3306/test_database?module=driver_test#bar',
         [
+          'module' => 'driver_test',
           'driver' => 'DrivertestMysql',
           'username' => 'test_user',
           'password' => 'test_pass',
@@ -165,6 +175,7 @@ public function providerConvertDbUrlToConnectionInfo() {
       'PostgreSQL contrib test driver without prefix' => [
         'DrivertestPgsql://test_user:test_pass@test_host:5432/test_database?module=driver_test',
         [
+          'module' => 'driver_test',
           'driver' => 'DrivertestPgsql',
           'username' => 'test_user',
           'password' => 'test_pass',
@@ -189,6 +200,7 @@ public function providerConvertDbUrlToConnectionInfo() {
       'PostgreSQL contrib test driver with prefix' => [
         'DrivertestPgsql://test_user:test_pass@test_host:5432/test_database?module=driver_test#bar',
         [
+          'module' => 'driver_test',
           'driver' => 'DrivertestPgsql',
           'username' => 'test_user',
           'password' => 'test_pass',
@@ -212,22 +224,9 @@ public function providerConvertDbUrlToConnectionInfo() {
         TRUE,
       ],
       'MySql with a custom query parameter' => [
-        'mysql://test_user:test_pass@test_host:3306/test_database?extra=value',
-        [
-          'driver' => 'mysql',
-          'username' => 'test_user',
-          'password' => 'test_pass',
-          'host' => 'test_host',
-          'database' => 'test_database',
-          'port' => 3306,
-          'namespace' => 'Drupal\mysql\Driver\Database\mysql',
-          'autoload' => 'core/modules/mysql/src/Driver/Database/mysql/',
-        ],
-        FALSE,
-      ],
-      'MySql with the module name mysql' => [
-        'mysql://test_user:test_pass@test_host:3306/test_database?module=mysql',
+        'mysql://test_user:test_pass@test_host:3306/test_database?module=mysql&extra=value',
         [
+          'module' => 'mysql',
           'driver' => 'mysql',
           'username' => 'test_user',
           'password' => 'test_pass',
@@ -239,22 +238,10 @@ public function providerConvertDbUrlToConnectionInfo() {
         ],
         FALSE,
       ],
-      'PostgreSql without the module name set' => [
-        'pgsql://test_user:test_pass@test_host/test_database',
-        [
-          'driver' => 'pgsql',
-          'username' => 'test_user',
-          'password' => 'test_pass',
-          'host' => 'test_host',
-          'database' => 'test_database',
-          'namespace' => 'Drupal\pgsql\Driver\Database\pgsql',
-          'autoload' => 'core/modules/pgsql/src/Driver/Database/pgsql/',
-        ],
-        FALSE,
-      ],
       'PostgreSql with the module name pgsql' => [
         'pgsql://test_user:test_pass@test_host/test_database?module=pgsql',
         [
+          'module' => 'pgsql',
           'driver' => 'pgsql',
           'username' => 'test_user',
           'password' => 'test_pass',
@@ -268,6 +255,7 @@ public function providerConvertDbUrlToConnectionInfo() {
       'SQLite, relative to root, without prefix and with the module name sqlite' => [
         'sqlite://localhost/test_database?module=sqlite',
         [
+          'module' => 'sqlite',
           'driver' => 'sqlite',
           'host' => 'localhost',
           'database' => $root . '/test_database',
@@ -279,6 +267,17 @@ public function providerConvertDbUrlToConnectionInfo() {
     ];
   }
 
+  /**
+   * Tests ::convertDbUrlToConnectionInfo() deprecation for missing module.
+   *
+   * @group legacy
+   */
+  public function testMissingModuleInUrlConversion(): void {
+    $this->expectDeprecation('Not passing a ?module=db_driver_module part in the $url argument of Drupal\Core\Database\Database::convertDbUrlToConnectionInfo() is deprecated in drupal:10.2.0 and is removed from drupal:11.0.0. All database connection URLs must have the module specified. See https://www.drupal.org/node/3129492');
+    $this->expectDeprecation('Not passing a ?module=db_driver_module part in the $url argument of Drupal\Core\Database\Connection::createConnectionOptionsFromUrl() is deprecated in drupal:10.2.0 and is removed from drupal:11.0.0. All database connection URLs must have the module specified. See https://www.drupal.org/node/3129492');
+    Database::convertDbUrlToConnectionInfo('pgsql://test_user:test_pass@test_host/test_database', $this->root);
+  }
+
   /**
    * Tests ::convertDbUrlToConnectionInfo() exception for invalid arguments.
    *
diff --git a/core/tests/Drupal/Tests/Core/Test/TestSetupTraitTest.php b/core/tests/Drupal/Tests/Core/Test/TestSetupTraitTest.php
index b6ba4e389db9659926bb1653fa75acc6dfd3197a..dfab1d561bbc8b52b24364f1bd728100bb19df24 100644
--- a/core/tests/Drupal/Tests/Core/Test/TestSetupTraitTest.php
+++ b/core/tests/Drupal/Tests/Core/Test/TestSetupTraitTest.php
@@ -26,8 +26,8 @@ class TestSetupTraitTest extends UnitTestCase {
    */
   public function testChangeDatabasePrefix() {
     $root = dirname(__FILE__, 7);
-    putenv('SIMPLETEST_DB=pgsql://user:pass@127.0.0.1/db');
-    $connection_info = Database::convertDbUrlToConnectionInfo('mysql://user:pass@localhost/db', $root);
+    putenv('SIMPLETEST_DB=pgsql://user:pass@127.0.0.1/db?module=pgsql');
+    $connection_info = Database::convertDbUrlToConnectionInfo('mysql://user:pass@localhost/db?module=mysql', $root);
     Database::addConnectionInfo('default', 'default', $connection_info);
     $this->assertEquals('mysql', Database::getConnectionInfo()['default']['driver']);
     $this->assertEquals('localhost', Database::getConnectionInfo()['default']['host']);
