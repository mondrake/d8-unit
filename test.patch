diff --git a/core/core.services.yml b/core/core.services.yml
index 6ac179594b..84f63fdf7b 100644
--- a/core/core.services.yml
+++ b/core/core.services.yml
@@ -1750,3 +1750,13 @@ services:
   pager.parameters:
     class: Drupal\Core\Pager\PagerParameters
     arguments: ['@request_stack']
+  select_extender_factory.pager:
+    class: Drupal\Core\Database\Query\PagerSelectExtenderFactory
+    arguments: ['@pager.manager']
+    tags:
+      - { name: backend_overridable }
+  select_extender_factory.table_sort:
+    class: Drupal\Core\Database\Query\TableSortExtenderFactory
+    arguments: ['@request_stack']
+    tags:
+      - { name: backend_overridable }
diff --git a/core/lib/Drupal/Core/Database/Connection.php b/core/lib/Drupal/Core/Database/Connection.php
index e0f9c5f631..46bf1970f9 100644
--- a/core/lib/Drupal/Core/Database/Connection.php
+++ b/core/lib/Drupal/Core/Database/Connection.php
@@ -2075,8 +2075,14 @@ public function getProvider(): string {
    *
    * @throws \Drupal\Core\DependencyInjection\ContainerNotInitializedException
    *   If the container has not been initialized yet.
+   *
+   * @deprecated in drupal:9.3.0 and is removed from drupal:10.0.0. Use
+   *   dependency injection instead.
+   *
+   * @see https://www.drupal.org/node/1234567
    */
   public function getPagerManager(): PagerManagerInterface {
+    @trigger_error(__METHOD__ . '() is deprecated in drupal:9.3.0 and is removed from drupal:10.0.0. Use dependency injection instead. See https://www.drupal.org/node/1234567', E_USER_DEPRECATED);
     return \Drupal::service('pager.manager');
   }
 
diff --git a/core/lib/Drupal/Core/Database/Query/PagerSelectExtender.php b/core/lib/Drupal/Core/Database/Query/PagerSelectExtender.php
index 1a53ec8601..372a429371 100644
--- a/core/lib/Drupal/Core/Database/Query/PagerSelectExtender.php
+++ b/core/lib/Drupal/Core/Database/Query/PagerSelectExtender.php
@@ -3,6 +3,7 @@
 namespace Drupal\Core\Database\Query;
 
 use Drupal\Core\Database\Connection;
+use Drupal\Core\Pager\PagerManagerInterface;
 
 /**
  * Query extender for pager queries.
@@ -16,6 +17,13 @@
  */
 class PagerSelectExtender extends SelectExtender {
 
+  /**
+   * The pager manager service.
+   *
+   * @var \Drupal\Core\Pager\PagerManagerInterface
+   */
+  protected $pagerManager;
+
   /**
    * The highest element we've autogenerated so far.
    *
@@ -56,9 +64,12 @@ class PagerSelectExtender extends SelectExtender {
    *   Select query object.
    * @param \Drupal\Core\Database\Connection $connection
    *   Database connection object.
+   * @param \Drupal\Core\Pager\PagerManagerInterface $pager_manager
+   *   The pager manager service.
    */
-  public function __construct(SelectInterface $query, Connection $connection) {
+  public function __construct(SelectInterface $query, Connection $connection, PagerManagerInterface $pager_manager = NULL) {
     parent::__construct($query, $connection);
+    $this->pagerManager = $pager_manager;
 
     // Add pager tag. Do this here to ensure that it is always added before
     // preExecute() is called.
@@ -86,7 +97,7 @@ public function execute() {
     $this->ensureElement();
 
     $total_items = $this->getCountQuery()->execute()->fetchField();
-    $pager = $this->connection->getPagerManager()->createPager($total_items, $this->limit, $this->element);
+    $pager = $this->pagerManager->createPager($total_items, $this->limit, $this->element);
     $this->range($pager->getCurrentPage() * $this->limit, $this->limit);
 
     // Now that we've added our pager-based range instructions, run the query normally.
@@ -101,7 +112,7 @@ public function execute() {
    */
   protected function ensureElement() {
     if (!isset($this->element)) {
-      $this->element($this->connection->getPagerManager()->getMaxPagerElementId() + 1);
+      $this->element($this->pagerManager->getMaxPagerElementId() + 1);
     }
   }
 
@@ -169,7 +180,7 @@ public function limit($limit = 10) {
    */
   public function element($element) {
     $this->element = $element;
-    $this->connection->getPagerManager()->reservePagerElementId($this->element);
+    $this->pagerManager->reservePagerElementId($this->element);
     return $this;
   }
 
diff --git a/core/lib/Drupal/Core/Database/Query/PagerSelectExtenderFactory.php b/core/lib/Drupal/Core/Database/Query/PagerSelectExtenderFactory.php
new file mode 100644
index 0000000000..4c19da9024
--- /dev/null
+++ b/core/lib/Drupal/Core/Database/Query/PagerSelectExtenderFactory.php
@@ -0,0 +1,45 @@
+<?php
+
+namespace Drupal\Core\Database\Query;
+
+use Drupal\Core\Database\Connection;
+use Drupal\Core\Pager\PagerManagerInterface;
+
+/**
+ * Select extender factory for pager queries.
+ */
+class PagerSelectExtenderFactory {
+
+  /**
+   * The pager manager service.
+   *
+   * @var \Drupal\Core\Pager\PagerManagerInterface
+   */
+  protected $pagerManager;
+
+  /**
+   * Constructs a PagerSelectExtenderFactory object.
+   *
+   * @param \Drupal\Core\Pager\PagerManagerInterface $pager_manager
+   *   The pager manager service.
+   */
+  public function __construct(PagerManagerInterface $pager_manager) {
+    $this->pagerManager = $pager_manager;
+  }
+
+  /**
+   * Returns a query extender for pager queries.
+   *
+   * @param \Drupal\Core\Database\Query\SelectInterface $query
+   *   Select query object.
+   * @param \Drupal\Core\Database\Connection $connection
+   *   Database connection object.
+   *
+   * @return \Drupal\Core\Database\Query\PagerSelectExtender
+   *   A query extender for pager queries.
+   */
+  public function get(SelectInterface $query, Connection $connection): PagerSelectExtender {
+    return new PagerSelectExtender($query, $connection, $this->pagerManager);
+  }
+
+}
diff --git a/core/lib/Drupal/Core/Database/Query/Select.php b/core/lib/Drupal/Core/Database/Query/Select.php
index 94cbf92b14..becdc149b4 100644
--- a/core/lib/Drupal/Core/Database/Query/Select.php
+++ b/core/lib/Drupal/Core/Database/Query/Select.php
@@ -318,7 +318,22 @@ public function havingCompile(Connection $connection) {
    * {@inheritdoc}
    */
   public function extend($extender_name) {
+    if ($extender_name === PagerSelectExtender::class || $extender_name === TableSortExtender::class) {
+      @trigger_error("Passing $extender_name to " . __METHOD__ . '() is deprecated in drupal:9.1.0 and is removed from drupal:10.0.0. Use the appropriate service. See https://www.drupal.org/node/1234567', E_USER_DEPRECATED);
+    }
+
+    // BC layer.
+    // @todo remove in Drupal 10.
+    // @see
     $parts = explode('\\', $extender_name);
+
+    if (count($parts) === 1) {
+      return \Drupal::service('select_extender_factory.' . $extender_name)->get($this, $this->connection);
+    }
+
+    // BC layer.
+    // @todo remove in Drupal 10.
+    // @see
     $class = end($parts);
     $driver_class = $this->connection->getDriverClass($class);
     if ($driver_class !== $class) {
diff --git a/core/lib/Drupal/Core/Database/Query/SelectExtender.php b/core/lib/Drupal/Core/Database/Query/SelectExtender.php
index 0681813f04..bf348602e6 100644
--- a/core/lib/Drupal/Core/Database/Query/SelectExtender.php
+++ b/core/lib/Drupal/Core/Database/Query/SelectExtender.php
@@ -218,10 +218,25 @@ public function havingNotExists(SelectInterface $select) {
    * {@inheritdoc}
    */
   public function extend($extender_name) {
+    if ($extender_name === PagerSelectExtender::class || $extender_name === TableSortExtender::class) {
+      @trigger_error("Passing $extender_name to " . __METHOD__ . '() is deprecated in drupal:9.1.0 and is removed from drupal:10.0.0. Use the appropriate service. See https://www.drupal.org/node/1234567', E_USER_DEPRECATED);
+    }
+
     // We cannot call $this->query->extend(), because with multiple extenders
     // you will replace all the earlier extenders with the last extender,
     // instead of creating list of objects that extend each other.
+    // BC layer.
+    // @todo remove in Drupal 10.
+    // @see
     $parts = explode('\\', $extender_name);
+
+    if (count($parts) === 1) {
+      return \Drupal::service('select_extender_factory.' . $extender_name)->get($this, $this->connection);
+    }
+
+    // BC layer.
+    // @todo remove in Drupal 10.
+    // @see
     $class = end($parts);
     $driver_class = $this->connection->getDriverClass($class);
     if ($driver_class !== $class) {
diff --git a/core/lib/Drupal/Core/Database/Query/TableSortExtender.php b/core/lib/Drupal/Core/Database/Query/TableSortExtender.php
index 60da1b864a..6c6d768d42 100644
--- a/core/lib/Drupal/Core/Database/Query/TableSortExtender.php
+++ b/core/lib/Drupal/Core/Database/Query/TableSortExtender.php
@@ -4,6 +4,7 @@
 
 use Drupal\Core\Database\Connection;
 use Drupal\Core\Utility\TableSort;
+use Symfony\Component\HttpFoundation\RequestStack;
 
 /**
  * Query extender class for tablesort queries.
@@ -11,10 +12,25 @@
 class TableSortExtender extends SelectExtender {
 
   /**
-   * {@inheritdoc}
+   * The request stack.
+   *
+   * @var \Symfony\Component\HttpFoundation\RequestStack
+   */
+  protected $requestStack;
+
+  /**
+   * Constructs a TableSortExtender object.
+   *
+   * @param \Drupal\Core\Database\Query\SelectInterface $query
+   *   Select query object.
+   * @param \Drupal\Core\Database\Connection $connection
+   *   Database connection object.
+   * @param \Symfony\Component\HttpFoundation\RequestStack $request_stack
+   *   The request stack.
    */
-  public function __construct(SelectInterface $query, Connection $connection) {
+  public function __construct(SelectInterface $query, Connection $connection, RequestStack $request_stack = NULL) {
     parent::__construct($query, $connection);
+    $this->requestStack = $request_stack;
 
     // Add convenience tag to mark that this is an extended query. We have to
     // do this in the constructor to ensure that it is set before preExecute()
@@ -34,7 +50,7 @@ public function __construct(SelectInterface $query, Connection $connection) {
    * @see table.html.twig
    */
   public function orderByHeader(array $header) {
-    $context = TableSort::getContextFromRequest($header, \Drupal::request());
+    $context = TableSort::getContextFromRequest($header, $this->requestStack->getCurrentRequest());
     if (!empty($context['sql'])) {
       // Based on code from \Drupal\Core\Database\Connection::escapeTable(),
       // but this can also contain a dot.
diff --git a/core/lib/Drupal/Core/Database/Query/TableSortExtenderFactory.php b/core/lib/Drupal/Core/Database/Query/TableSortExtenderFactory.php
new file mode 100644
index 0000000000..5eee532103
--- /dev/null
+++ b/core/lib/Drupal/Core/Database/Query/TableSortExtenderFactory.php
@@ -0,0 +1,45 @@
+<?php
+
+namespace Drupal\Core\Database\Query;
+
+use Drupal\Core\Database\Connection;
+use Symfony\Component\HttpFoundation\RequestStack;
+
+/**
+ * Select extender factory for tablesort queries.
+ */
+class TableSortExtenderFactory {
+
+  /**
+   * The request stack.
+   *
+   * @var \Symfony\Component\HttpFoundation\RequestStack
+   */
+  protected $requestStack;
+
+  /**
+   * Constructs a TableSortExtenderFactory object.
+   *
+   * @param \Symfony\Component\HttpFoundation\RequestStack $request_stack
+   *   The request stack.
+   */
+  public function __construct(RequestStack $request_stack) {
+    $this->requestStack = $request_stack;
+  }
+
+  /**
+   * Returns a query extender for tablesort queries.
+   *
+   * @param \Drupal\Core\Database\Query\SelectInterface $query
+   *   Select query object.
+   * @param \Drupal\Core\Database\Connection $connection
+   *   Database connection object.
+   *
+   * @return \Drupal\Core\Database\Query\TableSortExtender
+   *   A query extender for tablesort queries.
+   */
+  public function get(SelectInterface $query, Connection $connection): TableSortExtender {
+    return new TableSortExtender($query, $connection, $this->requestStack);
+  }
+
+}
diff --git a/core/lib/Drupal/Core/Pager/PagerManagerInterface.php b/core/lib/Drupal/Core/Pager/PagerManagerInterface.php
index 113fcb8430..c4e31f5bff 100644
--- a/core/lib/Drupal/Core/Pager/PagerManagerInterface.php
+++ b/core/lib/Drupal/Core/Pager/PagerManagerInterface.php
@@ -29,11 +29,11 @@ interface PagerManagerInterface {
    * If the items being displayed result from a database query performed using
    * Drupal's database API, and if you have control over the construction of the
    * database query, you do not need to call this function directly; instead,
-   * you can extend the query object with the 'PagerSelectExtender' extender
+   * you can extend the query object with the 'pager' select query extender
    * before executing it. For example:
    * @code
    *   $query = $connection->select('some_table')
-   *     ->extend(PagerSelectExtender::class);
+   *     ->extend('pager');
    * @endcode
    *
    * However, if you are using a different method for generating the items to be
diff --git a/core/modules/comment/src/CommentStorage.php b/core/modules/comment/src/CommentStorage.php
index 1b2c1b843a..ab9bf4c0a1 100644
--- a/core/modules/comment/src/CommentStorage.php
+++ b/core/modules/comment/src/CommentStorage.php
@@ -5,7 +5,6 @@
 use Drupal\Core\Cache\CacheBackendInterface;
 use Drupal\Core\Cache\MemoryCache\MemoryCacheInterface;
 use Drupal\Core\Database\Connection;
-use Drupal\Core\Database\Query\PagerSelectExtender;
 use Drupal\Core\Entity\EntityFieldManagerInterface;
 use Drupal\Core\Entity\EntityTypeBundleInfoInterface;
 use Drupal\Core\Entity\EntityTypeInterface;
@@ -288,7 +287,7 @@ public function loadThread(EntityInterface $entity, $field_name, $mode, $comment
       ->addMetaData('field_name', $field_name);
 
     if ($comments_per_page) {
-      $query = $query->extend(PagerSelectExtender::class)
+      $query = $query->extend('pager')
         ->limit($comments_per_page);
       if ($pager_id) {
         $query->element($pager_id);
diff --git a/core/modules/dblog/src/Controller/DbLogController.php b/core/modules/dblog/src/Controller/DbLogController.php
index 03d2ccc493..e04c9c4da4 100644
--- a/core/modules/dblog/src/Controller/DbLogController.php
+++ b/core/modules/dblog/src/Controller/DbLogController.php
@@ -9,8 +9,6 @@
 use Drupal\Component\Utility\UrlHelper;
 use Drupal\Core\Controller\ControllerBase;
 use Drupal\Core\Database\Connection;
-use Drupal\Core\Database\Query\PagerSelectExtender;
-use Drupal\Core\Database\Query\TableSortExtender;
 use Drupal\Core\Datetime\DateFormatterInterface;
 use Drupal\Core\Extension\ModuleHandlerInterface;
 use Drupal\Core\Form\FormBuilderInterface;
@@ -163,8 +161,8 @@ public function overview() {
     ];
 
     $query = $this->database->select('watchdog', 'w')
-      ->extend(PagerSelectExtender::class)
-      ->extend(TableSortExtender::class);
+      ->extend('pager')
+      ->extend('table_sort');
     $query->fields('w', [
       'wid',
       'uid',
@@ -429,8 +427,8 @@ public function topLogMessages($type) {
     $count_query->condition('type', $type);
 
     $query = $this->database->select('watchdog', 'w')
-      ->extend(PagerSelectExtender::class)
-      ->extend(TableSortExtender::class);
+      ->extend('pager')
+      ->extend('table_sort');
     $query->addExpression('COUNT([wid])', 'count');
     $query = $query
       ->fields('w', ['message', 'variables'])
diff --git a/core/modules/forum/src/ForumManager.php b/core/modules/forum/src/ForumManager.php
index 3a5ec47c74..f5befb746e 100644
--- a/core/modules/forum/src/ForumManager.php
+++ b/core/modules/forum/src/ForumManager.php
@@ -4,8 +4,6 @@
 
 use Drupal\Core\Config\ConfigFactoryInterface;
 use Drupal\Core\Database\Connection;
-use Drupal\Core\Database\Query\PagerSelectExtender;
-use Drupal\Core\Database\Query\TableSortExtender;
 use Drupal\Core\DependencyInjection\DependencySerializationTrait;
 use Drupal\Core\Entity\EntityFieldManagerInterface;
 use Drupal\Core\Entity\EntityTypeManagerInterface;
@@ -162,8 +160,8 @@ public function getTopics($tid, AccountInterface $account) {
     }
 
     $query = $this->connection->select('forum_index', 'f')
-      ->extend(PagerSelectExtender::class)
-      ->extend(TableSortExtender::class);
+      ->extend('pager')
+      ->extend('table_sort');
     $query->fields('f');
     $query
       ->condition('f.tid', $tid)
@@ -189,7 +187,7 @@ public function getTopics($tid, AccountInterface $account) {
       $nodes = $this->entityTypeManager->getStorage('node')->loadMultiple($nids);
 
       $query = $this->connection->select('node_field_data', 'n')
-        ->extend(TableSortExtender::class);
+        ->extend('table_sort');
       $query->fields('n', ['nid']);
 
       $query->join('comment_entity_statistics', 'ces', "[n].[nid] = [ces].[entity_id] AND [ces].[field_name] = 'comment_forum' AND [ces].[entity_type] = 'node'");
diff --git a/core/modules/help_topics/src/Plugin/Search/HelpSearch.php b/core/modules/help_topics/src/Plugin/Search/HelpSearch.php
index 49b0038d0d..3345b18256 100644
--- a/core/modules/help_topics/src/Plugin/Search/HelpSearch.php
+++ b/core/modules/help_topics/src/Plugin/Search/HelpSearch.php
@@ -6,7 +6,6 @@
 use Drupal\Core\Access\AccessResult;
 use Drupal\Core\Config\Config;
 use Drupal\Core\Database\Connection;
-use Drupal\Core\Database\Query\PagerSelectExtender;
 use Drupal\Core\Database\StatementInterface;
 use Drupal\Core\Language\LanguageInterface;
 use Drupal\Core\Language\LanguageManagerInterface;
@@ -18,7 +17,6 @@
 use Drupal\search\Plugin\SearchIndexingInterface;
 use Drupal\search\Plugin\SearchPluginBase;
 use Drupal\search\SearchIndexInterface;
-use Drupal\search\SearchQuery;
 use Symfony\Component\DependencyInjection\ContainerInterface;
 
 /**
@@ -220,8 +218,8 @@ protected function findResults() {
       ->select('search_index', 'i')
       // Restrict the search to the current interface language.
       ->condition('i.langcode', $this->languageManager->getCurrentLanguage()->getId())
-      ->extend(SearchQuery::class)
-      ->extend(PagerSelectExtender::class);
+      ->extend('search_query')
+      ->extend('pager');
     $query->innerJoin('help_search_items', 'hsi', '[i].[sid] = [hsi].[sid] AND [i].[type] = :type', [':type' => $this->getType()]);
     if ($denied_permissions) {
       $query->condition('hsi.permission', $denied_permissions, 'NOT IN');
diff --git a/core/modules/locale/src/StringDatabaseStorage.php b/core/modules/locale/src/StringDatabaseStorage.php
index 74e94fca5d..541b1d69d5 100644
--- a/core/modules/locale/src/StringDatabaseStorage.php
+++ b/core/modules/locale/src/StringDatabaseStorage.php
@@ -3,7 +3,6 @@
 namespace Drupal\locale;
 
 use Drupal\Core\Database\Connection;
-use Drupal\Core\Database\Query\PagerSelectExtender;
 
 /**
  * Defines a class to store localized strings in the database.
@@ -443,7 +442,7 @@ protected function dbStringSelect(array $conditions, array $options = []) {
     }
 
     if (!empty($options['pager limit'])) {
-      $query = $query->extend(PagerSelectExtender::class)->limit($options['pager limit']);
+      $query = $query->extend('pager')->limit($options['pager limit']);
     }
 
     return $query;
diff --git a/core/modules/node/src/Plugin/Search/NodeSearch.php b/core/modules/node/src/Plugin/Search/NodeSearch.php
index b23112ae31..323874154f 100644
--- a/core/modules/node/src/Plugin/Search/NodeSearch.php
+++ b/core/modules/node/src/Plugin/Search/NodeSearch.php
@@ -7,7 +7,6 @@
 use Drupal\Core\Cache\CacheableMetadata;
 use Drupal\Core\Config\Config;
 use Drupal\Core\Database\Connection;
-use Drupal\Core\Database\Query\PagerSelectExtender;
 use Drupal\Core\Database\Query\SelectExtender;
 use Drupal\Core\Database\StatementInterface;
 use Drupal\Core\Entity\EntityTypeManagerInterface;
@@ -262,8 +261,8 @@ protected function findResults() {
     // Build matching conditions.
     $query = $this->databaseReplica
       ->select('search_index', 'i')
-      ->extend(SearchQuery::class)
-      ->extend(PagerSelectExtender::class);
+      ->extend('search_query')
+      ->extend('pager');
     $query->join('node_field_data', 'n', '[n].[nid] = [i].[sid] AND [n].[langcode] = [i].[langcode]');
     $query->condition('n.status', 1)
       ->addTag('node_access')
diff --git a/core/modules/search/search.services.yml b/core/modules/search/search.services.yml
index 8f6e2a0fcc..107038260c 100644
--- a/core/modules/search/search.services.yml
+++ b/core/modules/search/search.services.yml
@@ -16,3 +16,15 @@ services:
   search.text_processor:
     class: Drupal\search\SearchTextProcessor
     arguments: ['@transliteration', '@config.factory', '@module_handler']
+
+  select_extender_factory.search_query:
+    class: Drupal\search\SearchQueryFactory
+    arguments: ['@config.factory', '@search.text_processor']
+    tags:
+      - { name: backend_overridable }
+
+  select_extender_factory.views_search_query:
+    class: Drupal\search\ViewsSearchQueryFactory
+    arguments: ['@config.factory', '@search.text_processor']
+    tags:
+      - { name: backend_overridable }
diff --git a/core/modules/search/src/Plugin/views/argument/Search.php b/core/modules/search/src/Plugin/views/argument/Search.php
index ab61880e14..0bc78b9967 100644
--- a/core/modules/search/src/Plugin/views/argument/Search.php
+++ b/core/modules/search/src/Plugin/views/argument/Search.php
@@ -48,7 +48,7 @@ public function init(ViewExecutable $view, DisplayPluginBase $display, array &$o
    */
   protected function queryParseSearchExpression($input) {
     if (!isset($this->searchQuery)) {
-      $this->searchQuery = \Drupal::service('database.replica')->select('search_index', 'i')->extend(ViewsSearchQuery::class);
+      $this->searchQuery = \Drupal::service('database.replica')->select('search_index', 'i')->extend('views_search_query');
       $this->searchQuery->searchExpression($input, $this->searchType);
       $this->searchQuery->publicParseSearchExpression();
     }
diff --git a/core/modules/search/src/Plugin/views/filter/Search.php b/core/modules/search/src/Plugin/views/filter/Search.php
index c0b0d4516b..4e90dfb260 100644
--- a/core/modules/search/src/Plugin/views/filter/Search.php
+++ b/core/modules/search/src/Plugin/views/filter/Search.php
@@ -120,7 +120,7 @@ public function validateExposed(&$form, FormStateInterface $form_state) {
   protected function queryParseSearchExpression($input) {
     if (!isset($this->searchQuery)) {
       $this->parsed = TRUE;
-      $this->searchQuery = \Drupal::service('database.replica')->select('search_index', 'i')->extend(ViewsSearchQuery::class);
+      $this->searchQuery = \Drupal::service('database.replica')->select('search_index', 'i')->extend('views_search_query');
       $this->searchQuery->searchExpression($input, $this->searchType);
       $this->searchQuery->publicParseSearchExpression();
     }
diff --git a/core/modules/search/src/SearchQuery.php b/core/modules/search/src/SearchQuery.php
index 92a1e10a74..2776dc65b0 100644
--- a/core/modules/search/src/SearchQuery.php
+++ b/core/modules/search/src/SearchQuery.php
@@ -2,6 +2,8 @@
 
 namespace Drupal\search;
 
+use Drupal\Core\Config\ConfigFactoryInterface;
+use Drupal\Core\Database\Connection;
 use Drupal\Core\Database\Query\SelectExtender;
 use Drupal\Core\Database\Query\SelectInterface;
 
@@ -73,6 +75,20 @@ class SearchQuery extends SelectExtender {
    */
   const NO_KEYWORD_MATCHES = 8;
 
+  /**
+   * The config factory.
+   *
+   * @var \Drupal\Core\Config\ConfigFactoryInterface
+   */
+  protected $configFactory;
+
+  /**
+   * The search text processor service.
+   *
+   * @var \Drupal\search\SearchTextProcessorInterface
+   */
+  protected $searchTextProcessor;
+
   /**
    * The keywords and advanced search options that are entered by the user.
    *
@@ -186,6 +202,24 @@ class SearchQuery extends SelectExtender {
    */
   protected $multiply = [];
 
+  /**
+   * Constructs a TableSortExtender object.
+   *
+   * @param \Drupal\Core\Database\Query\SelectInterface $query
+   *   Select query object.
+   * @param \Drupal\Core\Database\Connection $connection
+   *   Database connection object.
+   * @param \Drupal\Core\Config\ConfigFactoryInterface $config_factory
+   *   The config factory.
+   * @param \Drupal\search\SearchTextProcessorInterface $search_text_processor
+   *   The search text processor service.
+   */
+  public function __construct(SelectInterface $query, Connection $connection, ConfigFactoryInterface $config_factory = NULL, SearchTextProcessorInterface $search_text_processor = NULL) {
+    parent::__construct($query, $connection);
+    $this->configFactory = $config_factory;
+    $this->searchTextProcessor = $search_text_processor;
+  }
+
   /**
    * Sets the search query expression.
    *
@@ -231,9 +265,7 @@ protected function parseSearchExpression() {
 
     // Classify tokens.
     $in_or = FALSE;
-    $limit_combinations = \Drupal::config('search.settings')->get('and_or_limit');
-    /** @var \Drupal\search\SearchTextProcessorInterface $text_processor */
-    $text_processor = \Drupal::service('search.text_processor');
+    $limit_combinations = $this->configFactory->get('search.settings')->get('and_or_limit');
     // The first search expression does not count as AND.
     $and_count = -1;
     $or_count = 0;
@@ -256,7 +288,7 @@ protected function parseSearchExpression() {
       // Simplify keyword according to indexing rules and external
       // preprocessors. Use same process as during search indexing, so it
       // will match search index.
-      $words = $text_processor->analyze($match[2]);
+      $words = $this->searchTextProcessor->analyze($match[2]);
       // Re-explode in case simplification added more words, except when
       // matching a phrase.
       $words = $phrase ? [$words] : preg_split('/ /', $words, -1, PREG_SPLIT_NO_EMPTY);
@@ -364,7 +396,7 @@ protected function parseWord($word) {
     $split = explode(' ', $word);
     foreach ($split as $s) {
       $num = is_numeric($s);
-      if ($num || mb_strlen($s) >= \Drupal::config('search.settings')->get('index.minimum_word_size')) {
+      if ($num || mb_strlen($s) >= $this->configFactory->get('search.settings')->get('index.minimum_word_size')) {
         if (!isset($this->words[$s])) {
           $this->words[$s] = $s;
           $num_new_scores++;
diff --git a/core/modules/search/src/SearchQueryFactory.php b/core/modules/search/src/SearchQueryFactory.php
new file mode 100644
index 0000000000..968dbe8380
--- /dev/null
+++ b/core/modules/search/src/SearchQueryFactory.php
@@ -0,0 +1,56 @@
+<?php
+
+namespace Drupal\search;
+
+use Drupal\Core\Config\ConfigFactoryInterface;
+use Drupal\Core\Database\Connection;
+use Drupal\Core\Database\Query\SelectInterface;
+
+/**
+ * Select extender factory for search queries.
+ */
+class SearchQueryFactory {
+
+    /**
+     * The config factory.
+     *
+     * @var \Drupal\Core\Config\ConfigFactoryInterface
+     */
+    protected $configFactory;
+
+    /**
+     * The search text processor service.
+     *
+     * @var \Drupal\search\SearchTextProcessorInterface
+     */
+    protected $searchTextProcessor;
+
+    /**
+     * Constructs a SearchQueryFactory object.
+     *
+     * @param \Drupal\Core\Config\ConfigFactoryInterface $config_factory
+     *   The config factory.
+     * @param \Drupal\search\SearchTextProcessorInterface $search_text_processor
+     *   The search text processor service.
+     */
+    public function __construct(ConfigFactoryInterface $config_factory, SearchTextProcessorInterface $search_text_processor) {
+      $this->configFactory = $config_factory;
+      $this->searchTextProcessor = $search_text_processor;
+    }
+
+    /**
+     * Returns a query extender for search queries.
+     *
+     * @param \Drupal\Core\Database\Query\SelectInterface $query
+     *   Select query object.
+     * @param \Drupal\Core\Database\Connection $connection
+     *   Database connection object.
+     *
+     * @return Drupal\search\SearchQuery
+     *   A query extender for search queries.
+     */
+    public function get(SelectInterface $query, Connection $connection): SearchQuery {
+      return new SearchQuery($query, $connection, $this->configFactory, $this->searchTextProcessor);
+    }
+
+}
diff --git a/core/modules/search/src/ViewsSearchQueryFactory.php b/core/modules/search/src/ViewsSearchQueryFactory.php
new file mode 100644
index 0000000000..5f0fb459f7
--- /dev/null
+++ b/core/modules/search/src/ViewsSearchQueryFactory.php
@@ -0,0 +1,28 @@
+<?php
+
+namespace Drupal\search;
+
+use Drupal\Core\Database\Connection;
+use Drupal\Core\Database\Query\SelectInterface;
+
+/**
+ * Select extender factory for views search queries.
+ */
+class ViewsSearchQueryFactory extends SearchQueryFactory {
+
+    /**
+     * Returns a query extender for views search queries.
+     *
+     * @param \Drupal\Core\Database\Query\SelectInterface $query
+     *   Select query object.
+     * @param \Drupal\Core\Database\Connection $connection
+     *   Database connection object.
+     *
+     * @return Drupal\search\ViewsSearchQuery
+     *   A query extender for views search queries.
+     */
+    public function get(SelectInterface $query, Connection $connection): ViewsSearchQuery {
+      return new ViewsSearchQuery($query, $connection, $this->configFactory, $this->searchTextProcessor);
+    }
+
+}
diff --git a/core/modules/search/tests/src/Kernel/SearchMatchTest.php b/core/modules/search/tests/src/Kernel/SearchMatchTest.php
index 511c0ef678..513d597b10 100644
--- a/core/modules/search/tests/src/Kernel/SearchMatchTest.php
+++ b/core/modules/search/tests/src/Kernel/SearchMatchTest.php
@@ -6,7 +6,6 @@
 use Drupal\Core\Language\LanguageInterface;
 use Drupal\KernelTests\KernelTestBase;
 use Drupal\search\SearchIndexInterface;
-use Drupal\search\SearchQuery;
 
 /**
  * Indexes content and queries it.
@@ -165,7 +164,7 @@ public function _testQueries() {
     $connection = Database::getConnection();
     foreach ($queries as $query => $results) {
       $result = $connection->select('search_index', 'i')
-        ->extend(SearchQuery::class)
+        ->extend('search_query')
         ->searchExpression($query, static::SEARCH_TYPE)
         ->execute();
 
@@ -185,7 +184,7 @@ public function _testQueries() {
     ];
     foreach ($queries as $query => $results) {
       $result = $connection->select('search_index', 'i')
-        ->extend(SearchQuery::class)
+        ->extend('search_query')
         ->searchExpression($query, static::SEARCH_TYPE_2)
         ->execute();
 
@@ -208,7 +207,7 @@ public function _testQueries() {
     ];
     foreach ($queries as $query => $results) {
       $result = $connection->select('search_index', 'i')
-        ->extend(SearchQuery::class)
+        ->extend('search_query')
         ->searchExpression($query, static::SEARCH_TYPE_JPN)
         ->execute();
 
diff --git a/core/modules/system/tests/modules/database_test/src/Controller/DatabaseTestController.php b/core/modules/system/tests/modules/database_test/src/Controller/DatabaseTestController.php
index 2364e39fc7..7efff27676 100644
--- a/core/modules/system/tests/modules/database_test/src/Controller/DatabaseTestController.php
+++ b/core/modules/system/tests/modules/database_test/src/Controller/DatabaseTestController.php
@@ -4,8 +4,6 @@
 
 use Drupal\Core\Controller\ControllerBase;
 use Drupal\Core\Database\Connection;
-use Drupal\Core\Database\Query\PagerSelectExtender;
-use Drupal\Core\Database\Query\TableSortExtender;
 use Symfony\Component\DependencyInjection\ContainerInterface;
 use Symfony\Component\HttpFoundation\JsonResponse;
 
@@ -73,7 +71,7 @@ public function pagerQueryEven($limit) {
 
     // This should result in 2 pages of results.
     $query = $query
-      ->extend(PagerSelectExtender::class)
+      ->extend('pager')
       ->limit($limit);
 
     $names = $query->execute()->fetchCol();
@@ -99,7 +97,7 @@ public function pagerQueryOdd($limit) {
 
     // This should result in 4 pages of results.
     $query = $query
-      ->extend(PagerSelectExtender::class)
+      ->extend('pager')
       ->limit($limit);
 
     $names = $query->execute()->fetchCol();
@@ -130,7 +128,7 @@ public function testTablesort() {
       ->fields('t', ['tid', 'pid', 'task', 'priority']);
 
     $query = $query
-      ->extend(TableSortExtender::class)
+      ->extend('table_sort')
       ->orderByHeader($header);
 
     // We need all the results at once to check the sort.
@@ -162,7 +160,7 @@ public function testTablesortFirst() {
       ->fields('t', ['tid', 'pid', 'task', 'priority']);
 
     $query = $query
-      ->extend(TableSortExtender::class)
+      ->extend('table_sort')
       ->orderByHeader($header)
       ->orderBy('priority');
 
diff --git a/core/modules/system/tests/modules/database_test/src/Form/DatabaseTestForm.php b/core/modules/system/tests/modules/database_test/src/Form/DatabaseTestForm.php
index 5570c96f5f..07f538ad3a 100644
--- a/core/modules/system/tests/modules/database_test/src/Form/DatabaseTestForm.php
+++ b/core/modules/system/tests/modules/database_test/src/Form/DatabaseTestForm.php
@@ -3,8 +3,6 @@
 namespace Drupal\database_test\Form;
 
 use Drupal\Core\Database\Database;
-use Drupal\Core\Database\Query\PagerSelectExtender;
-use Drupal\Core\Database\Query\TableSortExtender;
 use Drupal\Core\Form\FormBase;
 use Drupal\Core\Form\FormStateInterface;
 use Drupal\user\Entity\User;
@@ -40,8 +38,8 @@ public function buildForm(array $form, FormStateInterface $form_state) {
     $count_query->addExpression('COUNT([u].[uid])');
 
     $query = $query
-      ->extend(PagerSelectExtender::class)
-      ->extend(TableSortExtender::class);
+      ->extend('pager')
+      ->extend('table_sort');
     $query
       ->fields('u', ['uid'])
       ->limit(50)
diff --git a/core/modules/system/tests/modules/pager_test/src/Controller/PagerTestController.php b/core/modules/system/tests/modules/pager_test/src/Controller/PagerTestController.php
index 2cdba66012..7ed5dfa9e7 100644
--- a/core/modules/system/tests/modules/pager_test/src/Controller/PagerTestController.php
+++ b/core/modules/system/tests/modules/pager_test/src/Controller/PagerTestController.php
@@ -4,7 +4,6 @@
 
 use Drupal\Core\Controller\ControllerBase;
 use Drupal\Core\Database\Database;
-use Drupal\Core\Database\Query\PagerSelectExtender;
 use Drupal\Core\Pager\PagerParametersInterface;
 use Drupal\Core\Security\TrustedCallbackInterface;
 use Symfony\Component\DependencyInjection\ContainerInterface;
@@ -55,7 +54,7 @@ protected function buildTestTable($element, $limit) {
       ['data' => 'type'],
       ['data' => 'timestamp'],
     ];
-    $query = Database::getConnection()->select('watchdog', 'd')->extend(PagerSelectExtender::class)->element($element);
+    $query = Database::getConnection()->select('watchdog', 'd')->extend('pager')->element($element);
     $result = $query
       ->fields('d', ['wid', 'type', 'timestamp'])
       ->limit($limit)
diff --git a/core/modules/system/tests/src/Functional/Database/SelectPagerDefaultTest.php b/core/modules/system/tests/src/Functional/Database/SelectPagerDefaultTest.php
index e261f6e9a3..8f832d6067 100644
--- a/core/modules/system/tests/src/Functional/Database/SelectPagerDefaultTest.php
+++ b/core/modules/system/tests/src/Functional/Database/SelectPagerDefaultTest.php
@@ -95,7 +95,7 @@ public function testOddPagerQuery() {
   public function testInnerPagerQuery() {
     $connection = Database::getConnection();
     $query = $connection->select('test', 't')
-      ->extend(PagerSelectExtender::class);
+      ->extend('pager');
     $query
       ->fields('t', ['age'])
       ->orderBy('age')
@@ -118,7 +118,7 @@ public function testInnerPagerQuery() {
    */
   public function testHavingPagerQuery() {
     $query = Database::getConnection()->select('test', 't')
-      ->extend(PagerSelectExtender::class);
+      ->extend('pager');
     $query
       ->fields('t', ['name'])
       ->orderBy('name')
@@ -145,7 +145,7 @@ public function testElementNumbers() {
 
     $connection = Database::getConnection();
     $query = $connection->select('test', 't')
-      ->extend(PagerSelectExtender::class)
+      ->extend('pager')
       ->element(2)
       ->fields('t', ['name'])
       ->orderBy('age')
@@ -161,7 +161,7 @@ public function testElementNumbers() {
     // Setting an element smaller than the previous one should not collide with
     // the existing pager.
     $query = $connection->select('test', 't')
-      ->extend(PagerSelectExtender::class)
+      ->extend('pager')
       ->element(1)
       ->fields('t', ['name'])
       ->orderBy('age')
@@ -175,7 +175,7 @@ public function testElementNumbers() {
     $this->assertEquals('George', $name, 'Pager query #2 with a specified element ID returned the correct results.');
 
     $query = $connection->select('test', 't')
-      ->extend(PagerSelectExtender::class)
+      ->extend('pager')
       ->fields('t', ['name'])
       ->orderBy('age')
       ->limit(1);
diff --git a/core/modules/tracker/src/Controller/TrackerController.php b/core/modules/tracker/src/Controller/TrackerController.php
index aeb65755ee..469f55a071 100644
--- a/core/modules/tracker/src/Controller/TrackerController.php
+++ b/core/modules/tracker/src/Controller/TrackerController.php
@@ -7,7 +7,6 @@
 use Drupal\Core\Cache\CacheableMetadata;
 use Drupal\Core\Controller\ControllerBase;
 use Drupal\Core\Database\Connection;
-use Drupal\Core\Database\Query\PagerSelectExtender;
 use Drupal\Core\Datetime\DateFormatterInterface;
 use Drupal\Core\Entity\EntityTypeManagerInterface;
 use Drupal\Core\Session\AccountInterface;
@@ -131,13 +130,13 @@ public function checkAccess(UserInterface $user, AccountInterface $account) {
   public function buildContent(UserInterface $user = NULL) {
     if ($user) {
       $query = $this->database->select('tracker_user', 't')
-        ->extend(PagerSelectExtender::class)
+        ->extend('pager')
         ->addMetaData('base_table', 'tracker_user')
         ->condition('t.uid', $user->id());
     }
     else {
       $query = $this->databaseReplica->select('tracker_node', 't')
-        ->extend(PagerSelectExtender::class)
+        ->extend('pager')
         ->addMetaData('base_table', 'tracker_node');
     }
 
diff --git a/core/modules/user/src/Plugin/Search/UserSearch.php b/core/modules/user/src/Plugin/Search/UserSearch.php
index 28f5d0e833..eabe843e77 100644
--- a/core/modules/user/src/Plugin/Search/UserSearch.php
+++ b/core/modules/user/src/Plugin/Search/UserSearch.php
@@ -4,7 +4,6 @@
 
 use Drupal\Core\Access\AccessResult;
 use Drupal\Core\Database\Connection;
-use Drupal\Core\Database\Query\PagerSelectExtender;
 use Drupal\Core\Entity\EntityTypeManagerInterface;
 use Drupal\Core\Extension\ModuleHandlerInterface;
 use Drupal\Core\Session\AccountInterface;
@@ -120,7 +119,7 @@ public function execute() {
     // Run the query to find matching users.
     $query = $this->database
       ->select('users_field_data', 'users')
-      ->extend(PagerSelectExtender::class);
+      ->extend('pager');
     $query->fields('users', ['uid']);
     $query->condition('default_langcode', 1);
     if ($this->currentUser->hasPermission('administer users')) {
diff --git a/core/tests/Drupal/KernelTests/Core/Database/SelectComplexTest.php b/core/tests/Drupal/KernelTests/Core/Database/SelectComplexTest.php
index 44ef6ccb47..401595236a 100644
--- a/core/tests/Drupal/KernelTests/Core/Database/SelectComplexTest.php
+++ b/core/tests/Drupal/KernelTests/Core/Database/SelectComplexTest.php
@@ -4,7 +4,6 @@
 
 use Drupal\Component\Render\FormattableMarkup;
 use Drupal\Core\Database\Database;
-use Drupal\Core\Database\Query\PagerSelectExtender;
 use Drupal\Core\Database\RowCountException;
 use Drupal\user\Entity\User;
 
@@ -211,7 +210,7 @@ public function testCountQuery() {
    */
   public function testHavingCountQuery() {
     $query = $this->connection->select('test')
-      ->extend(PagerSelectExtender::class)
+      ->extend('pager')
       ->groupBy('age')
       ->having('[age] + 1 > 0');
     $query->addField('test', 'age');
diff --git a/core/tests/Drupal/KernelTests/Core/Database/SelectExtenderTest.php b/core/tests/Drupal/KernelTests/Core/Database/SelectExtenderTest.php
index 5a23f9a250..7884c97a2f 100644
--- a/core/tests/Drupal/KernelTests/Core/Database/SelectExtenderTest.php
+++ b/core/tests/Drupal/KernelTests/Core/Database/SelectExtenderTest.php
@@ -114,6 +114,7 @@ public function providerExtend(): array {
    * @covers ::extend
    * @covers \Drupal\Core\Database\Query\SelectExtender::extend
    * @dataProvider providerExtend
+   * @group legacy
    */
   public function testExtend(string $expected, string $namespace, string $extend): void {
     $additional_class_loader = new ClassLoader();
diff --git a/core/tests/fixtures/database_drivers/module/corefake/corefake.services.yml b/core/tests/fixtures/database_drivers/module/corefake/corefake.services.yml
new file mode 100644
index 0000000000..13717140cd
--- /dev/null
+++ b/core/tests/fixtures/database_drivers/module/corefake/corefake.services.yml
@@ -0,0 +1,3 @@
+services:
+  corefakeWithAllCustomClasses.select_extender_factory.pager:
+    class: Drupal\corefake\PagerSelectExtenderFactory
diff --git a/core/tests/fixtures/database_drivers/module/corefake/src/PagerSelectExtenderFactory.php b/core/tests/fixtures/database_drivers/module/corefake/src/PagerSelectExtenderFactory.php
new file mode 100644
index 0000000000..d96d56da56
--- /dev/null
+++ b/core/tests/fixtures/database_drivers/module/corefake/src/PagerSelectExtenderFactory.php
@@ -0,0 +1,29 @@
+<?php
+
+namespace Drupal\corefake;
+
+use Drupal\Core\Database\Connection;
+use Drupal\Core\Database\Query\SelectInterface;
+use Drupal\corefake\Driver\Database\corefakeWithAllCustomClasses\PagerSelectExtender;
+
+/**
+ * Select extender factory for pager queries.
+ */
+class PagerSelectExtenderFactory {
+
+  /**
+   * Returns a query extender for pager queries.
+   *
+   * @param \Drupal\Core\Database\Query\SelectInterface $query
+   *   Select query object.
+   * @param \Drupal\Core\Database\Connection $connection
+   *   Database connection object.
+   *
+   * @return \Drupal\Core\Database\Query\PagerSelectExtender
+   *   A query extender for pager queries.
+   */
+  public function get(SelectInterface $query, Connection $connection): PagerSelectExtender {
+    return new PagerSelectExtender($query, $connection);
+  }
+
+}
